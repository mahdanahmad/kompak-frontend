{"version":3,"sources":["../../../../js/dashboard/essay/questionController.js"],"names":["app","controller","$scope","fetcher","$timeout","dialog","globalVar","limit","iterate","typeDelay","data","pauseAjx","doneAjx","search","nodata","loading","getSearch","length","loadMoar","_","omitBy","offset","like","category","id","isNil","getAllEssay","response","status_code","result","concat","delayTimeout","$watch","newVal","oldVal","cancel","initData","selectCate","selected","newQuestion","essayDialog","categories","dialResp","isObject","postEssay","mapValues","toString","edit","async","waterfall","callback","getEssay","message","questionData","before","clone","isEqual","err","console","log","putEssay","chain","omit","value","delete","question","e","stopPropagation","confirm","deleteEssay","init","getAllCategory","map","o","ID_category","name","category_name","sortBy","head"],"mappings":"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","file":"questionController.js","sourcesContent":["app.controller('EssayController', ['$scope', 'fetcher', '$timeout', 'dialog', 'globalVar', function ($scope, fetcher, $timeout, dialog, globalVar) {\n    'use strict';\n\n\tlet limit\t\t= 15;\n\tlet iterate\t\t= 0;\n\tlet typeDelay\t= 500;\n\n\t// $scope.categories\t= [];\n\t// $scope.category\t\t= {};\n\n\t$scope.data\t\t= [];\n\t$scope.pauseAjx\t= false;\n\t$scope.doneAjx\t= false;\n\n\t$scope.search\t= \"\";\n\t$scope.nodata\t= null;\n\t$scope.loading\t= globalVar.loading;\n\n\tlet getSearch\t= () => ($scope.search ? (($scope.search.length >= 3) ? $scope.search : null) : null);\n\n\t$scope.loadMoar\t= () => {\n\t\t$scope.pauseAjx\t= true;\n\t\titerate++;\n\t\tlet data = _.omitBy({\n\t\t\tlimit,\n\t\t\toffset: iterate * limit,\n\t\t\tlike: getSearch(),\n\t\t\tcategory: $scope.category.id\n\t\t}, _.isNil);\n\t\tfetcher.getAllEssay(data, (response) => {\n\t\t\tif (response.response == 'OK' && response.status_code == 200 && response.result) {\n\t\t\t\tif (response.result.length < limit) { $scope.doneAjx = true; }\n\t\t\t\t$scope.data \t= _.concat($scope.data, response.result);\n\t\t\t} else {\n\t\t\t\t$scope.doneAjx\t= true;\n\t\t\t}\n\t\t\t$scope.pauseAjx\t= false;\n\t\t});\n\t};\n\n\tlet delayTimeout;\n\t$scope.$watch('search', (newVal, oldVal) => {\n\t\tif (!_.isNil(newVal)) {\n\t\t\tif (delayTimeout) $timeout.cancel(delayTimeout);\n\n\t\t\tdelayTimeout\t= $timeout(() => {\n\t\t\t\tif (newVal !== oldVal && newVal.length >= 3) {\n\t\t\t\t\tinitData(newVal);\n\t\t\t\t} else if (newVal == '') {\n\t\t\t\t\tinitData();\n\t\t\t\t}\n\t\t\t}, typeDelay);\n\t\t} else {\n\t\t\t$scope.search = '';\n\t\t}\n\t});\n\n\t$scope.selectCate\t= (selected) => { $scope.category = selected; initData(getSearch()); }\n\n\t$scope.newQuestion\t= () => {\n\t\tdialog.essayDialog({ categories: $scope.categories }, (dialResp) => {\n\t\t\tif (_.isObject(dialResp)) {\n\t\t\t\tfetcher.postEssay(_.mapValues(dialResp, _.toString), (response) => {\n\t\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\t\tinitData(getSearch());\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\t$scope.edit\t= (id) => {\n\t\tasync.waterfall([\n\t\t\t(callback) => {\n\t\t\t\tfetcher.getEssay(id, (response) => {\n\t\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\t\tcallback(null, response.result);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcallback(response.message);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\t(questionData, callback) => {\n\t\t\t\tlet before\t= _.clone(questionData);\n\t\t\t\tdialog.essayDialog({ data: questionData, categories: $scope.categories }, (response) => {\n\t\t\t\t\tif (_.isObject(response) && !_.isEqual(before, response)) {\n\t\t\t\t\t\tcallback(null, response);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcallback(null);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t], (err, result) => {\n\t\t\tif (err) { console.log(err); }\n\n\t\t\tif (result) {\n\t\t\t\tfetcher.putEssay(result.id, _.chain(result).mapValues(_.toString).omit([]).value(), (response) => {\n\t\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\t\tinitData(getSearch());\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\n\t$scope.delete\t= (id, question, e) => {\n\t\te.stopPropagation();\n\t\tdialog.confirm('Are you sure you wanna delete question \\\"' + question + '\\\"?', (response) => {\n\t\t\tif (response) {\n\t\t\t\tfetcher.deleteEssay(id, (response) => {\n\t\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\t\tinitData(getSearch());\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tlet initData\t= (like) => {\n\t\t$scope.pauseAjx\t= true;\n\t\t$scope.nodata\t= null;\n\t\titerate\t= 0;\n\t\tfetcher.getAllEssay(_.omitBy({ limit, like, offset: 0, category: $scope.category.id }, _.isNil), (response) => {\n\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t$scope.data\t= response.result;\n\t\t\t\tif (!response.result) {\n\t\t\t\t\t$scope.nodata = globalVar.nodata;\n\t\t\t\t} else  if (response.result.length < limit) {\n\t\t\t\t\t$scope.doneAjx = true;\n\t\t\t\t} else {\n\t\t\t\t\t$scope.doneAjx\t= false;\n\t\t\t\t}\n\t\t\t\t$scope.pauseAjx\t= false;\n\t\t\t}\n\t\t});\n\t}\n\n\tlet init = () => {\n\t\tfetcher.getAllCategory({}, (response) => {\n\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t$scope.categories\t= _.chain(response.result).map((o) => ({ id: o.ID_category, name: o.category_name })).concat([{ id: null, name: 'All' }]).sortBy(['name']).value();\n\t\t\t\t$scope.category\t\t= _.head($scope.categories);\n\n\t\t\t\tinitData();\n\t\t\t}\n\t\t});\n\t}\n\n\tinit();\n}]);\n"]}