{"version":3,"sources":["../../../js/dashboard/statisticController.js"],"names":["app","controller","$scope","fetcher","$interval","$timeout","$window","dialog","globalVar","refreshRate","pieColor","downloadLink","name","getFilesLink","startdate","moment","startDate","format","dateFormat","enddate","endDate","year","startOf","toDate","dateChange","init","openList","state","getList","response","status_code","listDialog","result","openListVillage","id","data","pieoptions","chart","type","x","o","y","jumlah","showLabels","duration","labelThreshold","labelSunbeamLayout","labelsOutside","valueFormat","d3","cornerRadius","showLegend","color","i","legend","pie","dispatch","elementClick","e","angular","element","parent","attr","baroptions","margin","top","right","bottom","left","label","showValues","discretebar","overview","model","getStatistic","currentTime","maxVillage","_","chain","get","maxBy","value","timer","$on","cancel"],"mappings":"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","file":"statisticController.js","sourcesContent":["app.controller('StatisticController', ['$scope', 'fetcher', '$interval', '$timeout', '$window', 'dialog', 'globalVar', function ($scope, fetcher, $interval, $timeout, $window, dialog, globalVar) {\n    'use strict';\n\n\tlet refreshRate\t= 5; // in minutes\n\n\tlet pieColor\t= ['#535657', '#4F646F', '#519872', '#97B1A6', '#79AEA3', '#8E936D', '#779FA1', '#88AB75', '#2D93AD', '08605F', '#177E89'];\n\n\t$scope.downloadLink\t= (name) => (fetcher.getFilesLink(name, { startdate: moment($scope.startDate).format(globalVar.dateFormat), enddate: moment($scope.endDate).format(globalVar.dateFormat) }));\n\n\t$scope.startDate\t= moment().year(2017).startOf('year').toDate();\n\t$scope.endDate\t\t= moment().toDate();\n\t$scope.dateChange\t= () => { init(); }\n\n\t$scope.openList\t\t= (state) => {\n\t\tfetcher.getList({ startdate: moment($scope.startDate).format(globalVar.dateFormat), enddate: moment($scope.endDate).format(globalVar.dateFormat), state }, (response) => {\n\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\tdialog.listDialog(response.result);\n\t\t\t}\n\t\t});\n\t}\n\n\t$scope.openListVillage\t= (id) => {\n\t\tfetcher.getList({ startdate: moment($scope.startDate).format(globalVar.dateFormat), enddate: moment($scope.endDate).format(globalVar.dateFormat), state: 'villagedetil', id }, (response) => {\n\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\tdialog.listDialog(response.result);\n\t\t\t}\n\t\t});\n\t}\n\n\t$scope.data\t= {};\n\t$scope.pieoptions = {\n\t\tchart: {\n\t\t\ttype: 'pieChart',\n\t\t\t// width: 400,\n\t\t\t// height: 500,\n\t\t\tx: (o) => (o.name),\n\t\t\ty: (o) => (o.jumlah),\n\t\t\tshowLabels: false,\n\t\t\tduration: 500,\n\t\t\tlabelThreshold: 0.01,\n\t\t\tlabelSunbeamLayout: true,\n\t\t\tlabelsOutside: false,\n\t\t\tvalueFormat: (o) => (d3.format(\",\")(o)),\n\t\t\tcornerRadius: 4,\n\t\t\tshowLegend: true,\n\t\t\t// legendPosition: 'bottom',\n\t\t\tcolor: (o, i) => (pieColor[i] || '#000'),\n\t\t\tlegend: {},\n\t\t\tpie: {\n\t\t\t\tdispatch: {\n\t\t\t\t\telementClick: (e) => {\n\t\t\t\t\t\tlet state\t= angular.element(e.element).parent().parent().parent().parent().parent().parent().parent().parent().attr('id');\n\t\t\t\t\t\tlet id\t\t= e.data.id;\n\t\t\t\t\t\tfetcher.getList({ startdate: moment($scope.startDate).format(globalVar.dateFormat), enddate: moment($scope.endDate).format(globalVar.dateFormat), state, id }, (response) => {\n\t\t\t\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\t\t\t\tdialog.listDialog(response.result);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t};\n\n\t$scope.baroptions = {\n\t\tchart: {\n\t\t\ttype: 'discreteBarChart',\n\t\t\tmargin : {\n\t\t\t\ttop: 20,\n\t\t\t\tright: 20,\n\t\t\t\tbottom: 50,\n\t\t\t\tleft: 55\n\t\t\t},\n\t\t\tx: (o) => (o.label),\n\t\t\ty: (o) => (o.jumlah),\n\t\t\tshowValues: true,\n\t\t\tvalueFormat: (o) => (d3.format(\",\")(o)),\n\t\t\tduration: 500,\n\t\t\tcolor: (o, i) => ('#6dc0f9'),\n\t\t\tdiscretebar: {\n\t\t\t\tdispatch: {\n\t\t\t\t\telementClick: (e) => {\n\t\t\t\t\t\tfetcher.getList({ startdate: moment($scope.startDate).format(globalVar.dateFormat), enddate: moment($scope.endDate).format(globalVar.dateFormat), state: 'age', id: e.data.label }, (response) => {\n\t\t\t\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\t\t\t\tdialog.listDialog(response.result);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t$scope.overview\t= [\n\t\t[\n\t\t\t{ label: 'total pemain', model: 'total'},\n\t\t\t{ label: 'pemain masuk', model: 'login'},\n\t\t\t{ label: 'pertanyaan', model: 'pertanyaan'},\n\t\t\t{ label: 'jawaban', model: 'jawaban'},\n\t\t],\n\t\t[\n\t\t\t{ label: 'provinsi', model: 'province'},\n\t\t\t{ label: 'kabupaten', model: 'regency'},\n\t\t\t{ label: 'kecamatan', model: 'district'},\n\t\t\t{ label: 'desa', model: 'village'},\n\t\t],\n\t];\n\n\tlet init = () => {\n\t\tfetcher.getStatistic({ startdate: moment($scope.startDate).format(globalVar.dateFormat), enddate: moment($scope.endDate).format(globalVar.dateFormat) }, (response) => {\n\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t$scope.data\t= response.result;\n\t\t\t\t$scope.currentTime = moment().format(\"dddd, Do MMMM YYYY, hh:mm\");\n\t\t\t\t$scope.maxVillage = _.chain(response).get(['result', 'topvillage']).maxBy('jumlah').get('jumlah').value() || 1;\n\t\t\t}\n\t\t});\n\t}\n\n\tinit();\n\tlet timer = $interval(() => { init(); }, refreshRate * 60 * 1000);\n\t$scope.$on(\"$destroy\", () => { $interval.cancel(timer); });\n\n}]);\n"]}