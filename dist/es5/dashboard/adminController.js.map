{"version":3,"sources":["../../../js/dashboard/adminController.js"],"names":["app","controller","$scope","fetcher","$timeout","dialog","globalVar","localStorageService","limit","iterate","typeDelay","search","nodata","loading","data","pauseAjx","doneAjx","openHint","notif","adminHint","loadMoar","_","omitBy","offset","like","length","orderby","value","order","isNil","getAllAdmin","response","status_code","result","concat","delayTimeout","$watch","newVal","oldVal","cancel","init","newAdmin","adminDialog","dialResp","isObject","role","JSON","stringify","password","CryptoJS","SHA256","toString","postAdmin","message","error","editAdmin","o","before","clone","isEqual","putAdmin","id","delete","name","e","stopPropagation","confirm","deleteAdmin","get","$parent","logout"],"mappings":";;AAAAA,IAAIC,UAAJ,CAAe,iBAAf,EAAkC,CAAC,QAAD,EAAW,SAAX,EAAsB,UAAtB,EAAkC,QAAlC,EAA4C,WAA5C,EAAyD,qBAAzD,EAAgF,UAAUC,MAAV,EAAkBC,OAAlB,EAA2BC,QAA3B,EAAqCC,MAArC,EAA6CC,SAA7C,EAAwDC,mBAAxD,EAA6E;AAC3L;;AAEH,KAAIC,QAAS,EAAb;AACA,KAAIC,UAAW,CAAf;AACA,KAAIC,YAAY,GAAhB;;AAEAR,QAAOS,MAAP,GAAgB,EAAhB;AACAT,QAAOU,MAAP,GAAgB,IAAhB;AACAV,QAAOW,OAAP,GAAiBP,UAAUO,OAA3B;;AAEAX,QAAOY,IAAP,GAAe,EAAf;AACAZ,QAAOa,QAAP,GAAkB,KAAlB;AACAb,QAAOc,OAAP,GAAiB,KAAjB;;AAEAd,QAAOe,QAAP,GAAkB,YAAM;AAAEZ,SAAOa,KAAP,CAAaZ,UAAUa,SAAvB;AAAoC,EAA9D;;AAEAjB,QAAOkB,QAAP,GAAkB,YAAM;AACvBlB,SAAOa,QAAP,GAAkB,IAAlB;AACAN;AACA,MAAIK,OAAOO,EAAEC,MAAF,CAAS;AACnBd,eADmB;AAEnBe,WAAQd,UAAUD,KAFC;AAGnBgB,SAAMtB,OAAOS,MAAP,GAAkBT,OAAOS,MAAP,CAAcc,MAAd,IAAwB,CAAzB,GAA8BvB,OAAOS,MAArC,GAA8C,IAA/D,GAAuE,IAH1D;AAInBe,YAASxB,OAAOwB,OAAP,CAAeC,KAAf,GAAuB,GAAvB,GAA6BzB,OAAOwB,OAAP,CAAeE;AAJlC,GAAT,EAKRP,EAAEQ,KALM,CAAX;AAMA1B,UAAQ2B,WAAR,CAAoBhB,IAApB,EAA0B,UAACiB,QAAD,EAAc;AACvC,OAAIA,SAASA,QAAT,IAAqB,IAArB,IAA6BA,SAASC,WAAT,IAAwB,GAArD,IAA4DD,SAASE,MAAzE,EAAiF;AAChF,QAAIF,SAASE,MAAT,CAAgBR,MAAhB,GAAyBjB,KAA7B,EAAoC;AAAEN,YAAOc,OAAP,GAAiB,IAAjB;AAAwB;AAC9Dd,WAAOY,IAAP,GAAeO,EAAEa,MAAF,CAAShC,OAAOY,IAAhB,EAAsBiB,SAASE,MAA/B,CAAf;AACA,IAHD,MAGO;AACN/B,WAAOc,OAAP,GAAiB,IAAjB;AACA;AACDd,UAAOa,QAAP,GAAkB,KAAlB;AACA,GARD;AASA,EAlBD;;AAoBA,KAAIoB,qBAAJ;AACAjC,QAAOkC,MAAP,CAAc,QAAd,EAAwB,UAACC,MAAD,EAASC,MAAT,EAAoB;AAC3C,MAAI,CAACjB,EAAEQ,KAAF,CAAQQ,MAAR,CAAD,IAAoBA,WAAWC,MAAnC,EAA2C;AAC1C,OAAIH,YAAJ,EAAkB/B,SAASmC,MAAT,CAAgBJ,YAAhB;;AAElBA,kBAAe/B,SAAS,YAAM;AAC7B,QAAIiC,OAAOZ,MAAP,IAAiB,CAArB,EAAwB;AACvBe,UAAKH,MAAL;AACA,KAFD,MAEO,IAAIA,UAAU,EAAV,IAAgB,CAACnC,OAAOa,QAA5B,EAAsC;AAC5CyB;AACA;AACD,IANc,EAMZ9B,SANY,CAAf;AAOA,GAVD,MAUO;AACNR,UAAOS,MAAP,GAAgB,EAAhB;AACA;AACD,EAdD;;AAgBAT,QAAOuC,QAAP,GAAkB,YAAM;AACvBpC,SAAOqC,WAAP,CAAmB,EAAnB,EAAuB,UAACC,QAAD,EAAc;AACpC,OAAItB,EAAEuB,QAAF,CAAWD,QAAX,CAAJ,EAA0B;AACzBA,aAASE,IAAT,GAAiBC,KAAKC,SAAL,CAAeJ,SAASE,IAAxB,CAAjB;AACAF,aAASK,QAAT,GAAoBC,SAASC,MAAT,CAAgBP,SAASK,QAAzB,EAAmCG,QAAnC,EAApB;AACAhD,YAAQiD,SAAR,CAAkBT,QAAlB,EAA4B,UAACZ,QAAD,EAAc;AACzC,SAAIA,SAASA,QAAT,IAAqB,IAArB,IAA6BA,SAASC,WAAT,IAAwB,GAAzD,EAA8D;AAC7DQ,WAAKtC,OAAOS,MAAP,GAAkBT,OAAOS,MAAP,CAAcc,MAAd,IAAwB,CAAzB,GAA8BvB,OAAOS,MAArC,GAA8C,IAA/D,GAAuE,IAA5E;AACA,MAFD,MAEO,IAAIoB,SAASsB,OAAT,IAAoB,0DAAxB,EAAoF;AAC1FhD,aAAOiD,KAAP,CAAa,iDAAb;AACA;AACD,KAND;AAOA;AACD,GAZD;AAaA,EAdD;AAeApD,QAAOqD,SAAP,GAAmB,UAACC,CAAD,EAAO;AACzB,MAAIC,SAASpC,EAAEqC,KAAF,CAAQF,CAAR,CAAb;AACAnD,SAAOqC,WAAP,CAAmBe,MAAnB,EAA2B,UAACd,QAAD,EAAc;AACxC,OAAItB,EAAEuB,QAAF,CAAWD,QAAX,KAAwB,CAACtB,EAAEsC,OAAF,CAAUH,CAAV,EAAab,QAAb,CAA7B,EAAqD;AACpDA,aAASE,IAAT,GAAgBC,KAAKC,SAAL,CAAeJ,SAASE,IAAxB,CAAhB;AACA1C,YAAQyD,QAAR,CAAiBJ,EAAEK,EAAnB,EAAuBlB,QAAvB,EAAiC,UAACZ,QAAD,EAAc;AAC9C,SAAIA,SAASA,QAAT,IAAqB,IAArB,IAA6BA,SAASC,WAAT,IAAwB,GAAzD,EAA8D;AAC7DQ,WAAKtC,OAAOS,MAAP,GAAkBT,OAAOS,MAAP,CAAcc,MAAd,IAAwB,CAAzB,GAA8BvB,OAAOS,MAArC,GAA8C,IAA/D,GAAuE,IAA5E;AACA,MAFD,MAEO,IAAIoB,SAASsB,OAAT,IAAoB,0DAAxB,EAAoF;AAC1FhD,aAAOiD,KAAP,CAAa,iDAAb;AACA;AACD,KAND;AAOA;AACD,GAXD;AAYA,EAdD;;AAgBApD,QAAO4D,MAAP,GAAgB,UAACD,EAAD,EAAKE,IAAL,EAAWC,CAAX,EAAiB;AAChCA,IAAEC,eAAF;AACA5D,SAAO6D,OAAP,CAAe,sCAAsCH,IAAtC,GAA6C,QAA5D,EAAsE,UAAChC,QAAD,EAAc;AACnF,OAAIA,QAAJ,EAAc;AACb5B,YAAQgE,WAAR,CAAoBN,EAApB,EAAwB,UAAC9B,QAAD,EAAc;AACrC,SAAIA,SAASA,QAAT,IAAqB,IAArB,IAA6BA,SAASC,WAAT,IAAwB,GAAzD,EAA8D;AAC7D,UAAI6B,MAAMtD,oBAAoB6D,GAApB,CAAwB,IAAxB,CAAV,EAAyC;AACxClE,cAAOmE,OAAP,CAAeC,MAAf;AACA,OAFD,MAEO;AACN9B,YAAKtC,OAAOS,MAAP,GAAkBT,OAAOS,MAAP,CAAcc,MAAd,IAAwB,CAAzB,GAA8BvB,OAAOS,MAArC,GAA8C,IAA/D,GAAuE,IAA5E;AACA;AACD;AACD,KARD;AASA;AACD,GAZD;AAaA,EAfD;;AAiBA,KAAI6B,OAAO,SAAPA,IAAO,CAAChB,IAAD,EAAU;AACpBtB,SAAOa,QAAP,GAAkB,IAAlB;AACAb,SAAOU,MAAP,GAAgB,IAAhB;AACAH,YAAU,CAAV;AACAN,UAAQ2B,WAAR,CAAoBT,EAAEC,MAAF,CAAS,EAAEd,YAAF,EAASgB,UAAT,EAAeD,QAAQ,CAAvB,EAAT,EAAqCF,EAAEQ,KAAvC,CAApB,EAAmE,UAACE,QAAD,EAAc;AAChF,OAAIA,SAASA,QAAT,IAAqB,IAArB,IAA6BA,SAASC,WAAT,IAAwB,GAAzD,EAA8D;AAC7D9B,WAAOY,IAAP,GAAciB,SAASE,MAAvB;AACA,QAAI,CAACF,SAASE,MAAd,EAAsB;AACrB/B,YAAOU,MAAP,GAAgBN,UAAUM,MAA1B,CAAkCV,OAAOc,OAAP,GAAiB,IAAjB;AAClC,KAFD,MAEQ,IAAIe,SAASE,MAAT,CAAgBR,MAAhB,GAAyBjB,KAA7B,EAAoC;AAC3CN,YAAOc,OAAP,GAAiB,IAAjB;AACA,KAFO,MAED;AACNd,YAAOc,OAAP,GAAiB,KAAjB;AACA;AACDd,WAAOa,QAAP,GAAkB,KAAlB;AACA;AACD,GAZD;AAaA,EAjBD;;AAmBAyB;AACA,CA1HiC,CAAlC","file":"adminController.js","sourcesContent":["app.controller('AdminController', ['$scope', 'fetcher', '$timeout', 'dialog', 'globalVar', 'localStorageService', function ($scope, fetcher, $timeout, dialog, globalVar, localStorageService) {\n    'use strict';\n\n\tlet limit\t\t= 10;\n\tlet iterate\t\t= 0;\n\tlet typeDelay\t= 500;\n\n\t$scope.search\t= \"\";\n\t$scope.nodata\t= null;\n\t$scope.loading\t= globalVar.loading;\n\n\t$scope.data\t\t= [];\n\t$scope.pauseAjx\t= false;\n\t$scope.doneAjx\t= false;\n\n\t$scope.openHint\t= () => { dialog.notif(globalVar.adminHint); }\n\n\t$scope.loadMoar\t= () => {\n\t\t$scope.pauseAjx\t= true;\n\t\titerate++;\n\t\tlet data = _.omitBy({\n\t\t\tlimit,\n\t\t\toffset: iterate * limit,\n\t\t\tlike: $scope.search ? (($scope.search.length >= 3) ? $scope.search : null) : null,\n\t\t\torderby: $scope.orderby.value + ' ' + $scope.orderby.order,\n\t\t}, _.isNil);\n\t\tfetcher.getAllAdmin(data, (response) => {\n\t\t\tif (response.response == 'OK' && response.status_code == 200 && response.result) {\n\t\t\t\tif (response.result.length < limit) { $scope.doneAjx = true; }\n\t\t\t\t$scope.data \t= _.concat($scope.data, response.result);\n\t\t\t} else {\n\t\t\t\t$scope.doneAjx\t= true;\n\t\t\t}\n\t\t\t$scope.pauseAjx\t= false;\n\t\t});\n\t}\n\n\tlet delayTimeout;\n\t$scope.$watch('search', (newVal, oldVal) => {\n\t\tif (!_.isNil(newVal) && newVal !== oldVal) {\n\t\t\tif (delayTimeout) $timeout.cancel(delayTimeout);\n\n\t\t\tdelayTimeout\t= $timeout(() => {\n\t\t\t\tif (newVal.length >= 3) {\n\t\t\t\t\tinit(newVal);\n\t\t\t\t} else if (newVal == '' && !$scope.pauseAjx) {\n\t\t\t\t\tinit();\n\t\t\t\t}\n\t\t\t}, typeDelay);\n\t\t} else {\n\t\t\t$scope.search = '';\n\t\t}\n\t});\n\n\t$scope.newAdmin\t= () => {\n\t\tdialog.adminDialog({}, (dialResp) => {\n\t\t\tif (_.isObject(dialResp)) {\n\t\t\t\tdialResp.role\t\t= JSON.stringify(dialResp.role);\n\t\t\t\tdialResp.password\t= CryptoJS.SHA256(dialResp.password).toString();\n\t\t\t\tfetcher.postAdmin(dialResp, (response) => {\n\t\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\t\tinit($scope.search ? (($scope.search.length >= 3) ? $scope.search : null) : null);\n\t\t\t\t\t} else if (response.message == \"Duplicate primary key(s). Please check again your input.\") {\n\t\t\t\t\t\tdialog.error(\"Penambahan data gagal, username sudah terpakai.\");\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\t$scope.editAdmin\t= (o) => {\n\t\tlet before\t= _.clone(o);\n\t\tdialog.adminDialog(before, (dialResp) => {\n\t\t\tif (_.isObject(dialResp) && !_.isEqual(o, dialResp)) {\n\t\t\t\tdialResp.role\t= JSON.stringify(dialResp.role);\n\t\t\t\tfetcher.putAdmin(o.id, dialResp, (response) => {\n\t\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\t\tinit($scope.search ? (($scope.search.length >= 3) ? $scope.search : null) : null);\n\t\t\t\t\t} else if (response.message == \"Duplicate primary key(s). Please check again your input.\") {\n\t\t\t\t\t\tdialog.error(\"Pengubahan data gagal, username sudah terpakai.\");\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\n\t$scope.delete\t= (id, name, e) => {\n\t\te.stopPropagation();\n\t\tdialog.confirm('Apakah anda yakin akan menghapus ' + name + ' akun?', (response) => {\n\t\t\tif (response) {\n\t\t\t\tfetcher.deleteAdmin(id, (response) => {\n\t\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\t\tif (id == localStorageService.get('id')) {\n\t\t\t\t\t\t\t$scope.$parent.logout();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tinit($scope.search ? (($scope.search.length >= 3) ? $scope.search : null) : null);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tlet init\t= (like) => {\n\t\t$scope.pauseAjx\t= true;\n\t\t$scope.nodata\t= null;\n\t\titerate\t= 0;\n\t\tfetcher.getAllAdmin(_.omitBy({ limit, like, offset: 0 }, _.isNil), (response) => {\n\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t$scope.data\t= response.result;\n\t\t\t\tif (!response.result) {\n\t\t\t\t\t$scope.nodata = globalVar.nodata; $scope.doneAjx = true;\n\t\t\t\t} else  if (response.result.length < limit) {\n\t\t\t\t\t$scope.doneAjx = true;\n\t\t\t\t} else {\n\t\t\t\t\t$scope.doneAjx\t= false;\n\t\t\t\t}\n\t\t\t\t$scope.pauseAjx\t= false;\n\t\t\t}\n\t\t});\n\t}\n\n\tinit();\n}]);\n"]}