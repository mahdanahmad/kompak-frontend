{"version":3,"sources":["../../../js/dashboard/locationController.js"],"names":["app","controller","$scope","fetcher","$timeout","$state","$stateParams","dialog","globalVar","limit","iterate","typeDelay","id","defId","prevState","locMap","province","regency","district","village","openHint","notif","locationHint","_","isNil","state","data","pauseAjx","doneAjx","search","nodata","loading","gotoLocation","newLocation","go","assign","omit","backLocation","currentLocation","getSearch","length","mapName","chain","map","o","pickBy","d","key","includes","startsWith","mapKeys","value","loadMoar","omitBy","offset","like","getLocation","response","status_code","result","concat","delayTimeout","$watch","newVal","oldVal","cancel","init","locationDialog","isNew","dialResp","isObject","postLocation","mapValues","toString","error","message","edit","e","stopPropagation","clone","putLocation","delete","locId","location","confirm","deleteLocation","title","name"],"mappings":"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","file":"locationController.js","sourcesContent":["app.controller('LocationController', ['$scope', 'fetcher', '$timeout', '$state', '$stateParams', 'dialog', 'globalVar', function ($scope, fetcher, $timeout, $state, $stateParams, dialog, globalVar) {\n    'use strict';\n\n\tlet limit\t\t= 20;\n\tlet iterate\t\t= 0;\n\tlet typeDelay\t= 500;\n\n\tlet id\t\t\t= '';\n\tlet defId\t\t= '';\n\tlet prevState\t= '';\n\n\t// let hint\t\t= '<i class=\"fa fa-question-circle-o cursor-pointer\" aria-hidden=\"true\"><md-tooltip md-autohide=\"true\">petunjuk penggunaan halaman</md-tooltip></i>';\n\t$scope.locMap\t= { province : 'provinsi', regency: 'kabupaten', district: 'kecamatan', village: 'desa' };\n\n\t$scope.openHint\t= () => { dialog.notif(globalVar.locationHint); }\n\n\tswitch (true) {\n\t\tcase !_.isNil($stateParams.province) && !_.isNil($stateParams.regency) && !_.isNil($stateParams.district):\n\t\t\tid\t= $stateParams.province + '/' + $stateParams.regency + '/' + $stateParams.district + '/';\n\t\t\t$scope.state\t= 'village'; defId = $stateParams.district; prevState = 'district';\n\t\t\tbreak;\n\t\tcase !_.isNil($stateParams.province) && !_.isNil($stateParams.regency):\n\t\t\tid\t= $stateParams.province + '/' + $stateParams.regency + '/';\n\t\t\t$scope.state\t= 'district'; defId = $stateParams.regency; prevState = 'regency';\n\t\t\tbreak;\n\t\tcase !_.isNil($stateParams.province):\n\t\t\tid\t= $stateParams.province + '/';\n\t\t\t$scope.state\t= 'regency';  defId = $stateParams.province; prevState = 'province';\n\t\t\tbreak;\n\t\tdefault:\n\t\t\t$scope.state\t= 'province';\n\t}\n\n\t$scope.data\t\t= [];\n\t$scope.pauseAjx\t= false;\n\t$scope.doneAjx\t= false;\n\n\t$scope.search\t= \"\";\n\t$scope.nodata\t= null;\n\t$scope.loading\t= globalVar.loading;\n\n\t$scope.gotoLocation\t= (id) => {\n\t\tlet newLocation\t= { };\n\t\tnewLocation[$scope.state]\t= id;\n\n\t\t$state.go('dashboard.location', _.assign({}, _.omit($stateParams, ['#']), newLocation));\n\t}\n\n\t$scope.backLocation\t= () => {\n\t\tlet currentLocation\t= { };\n\t\tcurrentLocation[prevState]\t= null;\n\n\t\t$state.go('dashboard.location', _.assign({}, _.omit($stateParams, ['#']), currentLocation));\n\t}\n\n\tlet getSearch\t= () => ($scope.search ? (($scope.search.length >= 3) ? $scope.search : null) : null);\n\n\tlet mapName\t= (data) => (\n\t\t_.chain(data).map((o) => (\n\t\t\t_.chain(o).pickBy((d, key) => ( _.includes(['id'], key) || _.startsWith(key, 'name') )).mapKeys((d, key) => (key == 'id' ? 'id' : 'name')).value()\n\t\t)).value()\n\t);\n\n\t$scope.loadMoar\t= () => {\n\t\t$scope.pauseAjx\t= true;\n\t\titerate++;\n\t\tlet data = _.omitBy({\n\t\t\tlimit,\n\t\t\toffset: iterate * limit,\n\t\t\tlike: getSearch()\n\t\t}, _.isNil);\n\t\tfetcher.getLocation(id, data, (response) => {\n\t\t\tif (response.response == 'OK' && response.status_code == 200 && response.result.data) {\n\t\t\t\tif (response.result.data.length < limit) { $scope.doneAjx = true; }\n\t\t\t\t$scope.data \t= _.concat($scope.data, mapName(response.result.data));\n\t\t\t} else {\n\t\t\t\t$scope.doneAjx\t= true;\n\t\t\t}\n\t\t\t$scope.pauseAjx\t= false;\n\t\t});\n\t};\n\n\tlet delayTimeout;\n\t$scope.$watch('search', (newVal, oldVal) => {\n\t\tif (!_.isNil(newVal) && newVal !== oldVal) {\n\t\t\tif (delayTimeout) $timeout.cancel(delayTimeout);\n\n\t\t\tdelayTimeout\t= $timeout(() => {\n\t\t\t\tif (newVal.length >= 3) {\n\t\t\t\t\tinit(newVal);\n\t\t\t\t} else if (newVal == '' && !$scope.pauseAjx) {\n\t\t\t\t\tinit();\n\t\t\t\t}\n\t\t\t}, typeDelay);\n\t\t} else {\n\t\t\t$scope.search = '';\n\t\t}\n\t});\n\n\t$scope.newLocation\t= () => {\n\t\tdialog.locationDialog({ state: $scope.locMap[$scope.state], isNew: true, data: { id: defId } }, (dialResp) => {\n\t\t\tif (_.isObject(dialResp)) {\n\t\t\t\tfetcher.postLocation(id, _.mapValues(dialResp, _.toString), (response) => {\n\t\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\t\tinit(getSearch());\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdialog.error(response.message);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\t$scope.edit\t= (o, e) => {\n\t\te.stopPropagation();\n\t\tdialog.locationDialog({ state: $scope.locMap[$scope.state], isNew: false, data: _.clone(o) }, (dialResp) => {\n\t\t\tif (_.isObject(dialResp)) {\n\t\t\t\tfetcher.putLocation(id + o.id, _.mapValues(dialResp, _.toString), (response) => {\n\t\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\t\tinit(getSearch());\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdialog.error(response.message);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\n\t$scope.delete\t= (locId, location, e) => {\n\t\te.stopPropagation();\n\t\tdialog.confirm('Apakah anda yakin akan menghapus \\\"' + location + '\\\"?', (response) => {\n\t\t\tif (response) {\n\t\t\t\tfetcher.deleteLocation(id + locId, (response) => {\n\t\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\t\tinit(getSearch());\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdialog.error(response.message);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tlet init = (like) => {\n\t\t$scope.pauseAjx\t= true;\n\t\t$scope.nodata\t= null;\n\t\titerate\t= 0;\n\t\tfetcher.getLocation(id, _.omitBy({ limit, like, offset: 0 }, _.isNil), (response) => {\n\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t$scope.title\t= ($scope.state == 'province' ? '<span>semua</span> provinsi' : ($scope.locMap[$scope.state] + ' <span>di ' + response.result.name + '</span>'));\n\t\t\t\t$scope.data\t\t= mapName(response.result.data);\n\t\t\t\tif (!response.result.data) {\n\t\t\t\t\t$scope.nodata = globalVar.nodata; $scope.doneAjx = true;\n\t\t\t\t} else if (response.result.data.length < limit) {\n\t\t\t\t\t$scope.doneAjx = true;\n\t\t\t\t} else {\n\t\t\t\t\t$scope.doneAjx\t= false;\n\t\t\t\t}\n\t\t\t\t$scope.pauseAjx\t= false;\n\t\t\t}\n\t\t});\n\t}\n\n\tinit();\n}]);\n"]}