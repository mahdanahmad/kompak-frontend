{"version":3,"sources":["../../../js/dashboard/locationController.js"],"names":["app","controller","$scope","fetcher","$timeout","$state","$stateParams","dialog","globalVar","limit","iterate","typeDelay","id","defId","prevState","_","isNil","province","regency","district","state","data","pauseAjx","doneAjx","search","nodata","loading","gotoLocation","newLocation","go","assign","omit","backLocation","currentLocation","getSearch","length","mapName","chain","map","o","pickBy","d","key","includes","startsWith","mapKeys","value","loadMoar","omitBy","offset","like","getLocation","response","status_code","result","concat","delayTimeout","$watch","newVal","oldVal","cancel","init","locationDialog","isNew","dialResp","isObject","postLocation","mapValues","toString","error","message","edit","e","stopPropagation","clone","putLocation","delete","locId","question","confirm","deleteLocation","title","name"],"mappings":";;AAAAA,IAAIC,UAAJ,CAAe,oBAAf,EAAqC,CAAC,QAAD,EAAW,SAAX,EAAsB,UAAtB,EAAkC,QAAlC,EAA4C,cAA5C,EAA4D,QAA5D,EAAsE,WAAtE,EAAmF,UAAUC,MAAV,EAAkBC,OAAlB,EAA2BC,QAA3B,EAAqCC,MAArC,EAA6CC,YAA7C,EAA2DC,MAA3D,EAAmEC,SAAnE,EAA8E;AAClM;;AAEH,KAAIC,QAAS,EAAb;AACA,KAAIC,UAAW,CAAf;AACA,KAAIC,YAAY,GAAhB;;AAEA,KAAIC,KAAO,EAAX;AACA,KAAIC,QAAS,EAAb;AACA,KAAIC,YAAY,EAAhB;AACA,SAAQ,IAAR;AACC,OAAK,CAACC,EAAEC,KAAF,CAAQV,aAAaW,QAArB,CAAD,IAAmC,CAACF,EAAEC,KAAF,CAAQV,aAAaY,OAArB,CAApC,IAAqE,CAACH,EAAEC,KAAF,CAAQV,aAAaa,QAArB,CAA3E;AACCP,QAAKN,aAAaW,QAAb,GAAwB,GAAxB,GAA8BX,aAAaY,OAA3C,GAAqD,GAArD,GAA2DZ,aAAaa,QAAxE,GAAmF,GAAxF;AACAjB,UAAOkB,KAAP,GAAe,SAAf,CAA0BP,QAAQP,aAAaa,QAArB,CAA+BL,YAAY,UAAZ;AACzD;AACD,OAAK,CAACC,EAAEC,KAAF,CAAQV,aAAaW,QAArB,CAAD,IAAmC,CAACF,EAAEC,KAAF,CAAQV,aAAaY,OAArB,CAAzC;AACCN,QAAKN,aAAaW,QAAb,GAAwB,GAAxB,GAA8BX,aAAaY,OAA3C,GAAqD,GAA1D;AACAhB,UAAOkB,KAAP,GAAe,UAAf,CAA2BP,QAAQP,aAAaY,OAArB,CAA8BJ,YAAY,SAAZ;AACzD;AACD,OAAK,CAACC,EAAEC,KAAF,CAAQV,aAAaW,QAArB,CAAN;AACCL,QAAKN,aAAaW,QAAb,GAAwB,GAA7B;AACAf,UAAOkB,KAAP,GAAe,SAAf,CAA2BP,QAAQP,aAAaW,QAArB,CAA+BH,YAAY,UAAZ;AAC1D;AACD;AACCZ,UAAOkB,KAAP,GAAe,UAAf;AAdF;;AAiBAlB,QAAOmB,IAAP,GAAe,EAAf;AACAnB,QAAOoB,QAAP,GAAkB,KAAlB;AACApB,QAAOqB,OAAP,GAAiB,KAAjB;;AAEArB,QAAOsB,MAAP,GAAgB,EAAhB;AACAtB,QAAOuB,MAAP,GAAgB,IAAhB;AACAvB,QAAOwB,OAAP,GAAiBlB,UAAUkB,OAA3B;;AAEAxB,QAAOyB,YAAP,GAAsB,UAACf,EAAD,EAAQ;AAC7B,MAAIgB,cAAc,EAAlB;AACAA,cAAY1B,OAAOkB,KAAnB,IAA4BR,EAA5B;;AAEAP,SAAOwB,EAAP,CAAU,oBAAV,EAAgCd,EAAEe,MAAF,CAAS,EAAT,EAAaf,EAAEgB,IAAF,CAAOzB,YAAP,EAAqB,CAAC,GAAD,CAArB,CAAb,EAA0CsB,WAA1C,CAAhC;AACA,EALD;;AAOA1B,QAAO8B,YAAP,GAAsB,YAAM;AAC3B,MAAIC,kBAAkB,EAAtB;AACAA,kBAAgBnB,SAAhB,IAA6B,IAA7B;;AAEAT,SAAOwB,EAAP,CAAU,oBAAV,EAAgCd,EAAEe,MAAF,CAAS,EAAT,EAAaf,EAAEgB,IAAF,CAAOzB,YAAP,EAAqB,CAAC,GAAD,CAArB,CAAb,EAA0C2B,eAA1C,CAAhC;AACA,EALD;;AAOA,KAAIC,YAAY,SAAZA,SAAY;AAAA,SAAOhC,OAAOsB,MAAP,GAAkBtB,OAAOsB,MAAP,CAAcW,MAAd,IAAwB,CAAzB,GAA8BjC,OAAOsB,MAArC,GAA8C,IAA/D,GAAuE,IAA9E;AAAA,EAAhB;;AAEA,KAAIY,UAAU,SAAVA,OAAU,CAACf,IAAD;AAAA,SACbN,EAAEsB,KAAF,CAAQhB,IAAR,EAAciB,GAAd,CAAkB,UAACC,CAAD;AAAA,UACjBxB,EAAEsB,KAAF,CAAQE,CAAR,EAAWC,MAAX,CAAkB,UAACC,CAAD,EAAIC,GAAJ;AAAA,WAAc3B,EAAE4B,QAAF,CAAW,CAAC,IAAD,CAAX,EAAmBD,GAAnB,KAA2B3B,EAAE6B,UAAF,CAAaF,GAAb,EAAkB,MAAlB,CAAzC;AAAA,IAAlB,EAAwFG,OAAxF,CAAgG,UAACJ,CAAD,EAAIC,GAAJ;AAAA,WAAaA,OAAO,IAAP,GAAc,IAAd,GAAqB,MAAlC;AAAA,IAAhG,EAA2II,KAA3I,EADiB;AAAA,GAAlB,EAEGA,KAFH,EADa;AAAA,EAAd;;AAMA5C,QAAO6C,QAAP,GAAkB,YAAM;AACvB7C,SAAOoB,QAAP,GAAkB,IAAlB;AACAZ;AACA,MAAIW,OAAON,EAAEiC,MAAF,CAAS;AACnBvC,eADmB;AAEnBwC,WAAQvC,UAAUD,KAFC;AAGnByC,SAAMhB;AAHa,GAAT,EAIRnB,EAAEC,KAJM,CAAX;AAKAb,UAAQgD,WAAR,CAAoBvC,EAApB,EAAwBS,IAAxB,EAA8B,UAAC+B,QAAD,EAAc;AAC3C,OAAIA,SAASA,QAAT,IAAqB,IAArB,IAA6BA,SAASC,WAAT,IAAwB,GAArD,IAA4DD,SAASE,MAAT,CAAgBjC,IAAhF,EAAsF;AACrF,QAAI+B,SAASE,MAAT,CAAgBjC,IAAhB,CAAqBc,MAArB,GAA8B1B,KAAlC,EAAyC;AAAEP,YAAOqB,OAAP,GAAiB,IAAjB;AAAwB;AACnErB,WAAOmB,IAAP,GAAeN,EAAEwC,MAAF,CAASrD,OAAOmB,IAAhB,EAAsBe,QAAQgB,SAASE,MAAT,CAAgBjC,IAAxB,CAAtB,CAAf;AACA,IAHD,MAGO;AACNnB,WAAOqB,OAAP,GAAiB,IAAjB;AACA;AACDrB,UAAOoB,QAAP,GAAkB,KAAlB;AACA,GARD;AASA,EAjBD;;AAmBA,KAAIkC,qBAAJ;AACAtD,QAAOuD,MAAP,CAAc,QAAd,EAAwB,UAACC,MAAD,EAASC,MAAT,EAAoB;AAC3C,MAAI,CAAC5C,EAAEC,KAAF,CAAQ0C,MAAR,CAAD,IAAoBA,WAAWC,MAAnC,EAA2C;AAC1C,OAAIH,YAAJ,EAAkBpD,SAASwD,MAAT,CAAgBJ,YAAhB;;AAElBA,kBAAepD,SAAS,YAAM;AAC7B,QAAIsD,OAAOvB,MAAP,IAAiB,CAArB,EAAwB;AACvB0B,UAAKH,MAAL;AACA,KAFD,MAEO,IAAIA,UAAU,EAAV,IAAgB,CAACxD,OAAOoB,QAA5B,EAAsC;AAC5CuC;AACA;AACD,IANc,EAMZlD,SANY,CAAf;AAOA,GAVD,MAUO;AACNT,UAAOsB,MAAP,GAAgB,EAAhB;AACA;AACD,EAdD;;AAgBAtB,QAAO0B,WAAP,GAAqB,YAAM;AAC1BrB,SAAOuD,cAAP,CAAsB,EAAE1C,OAAOlB,OAAOkB,KAAhB,EAAuB2C,OAAO,IAA9B,EAAoC1C,MAAM,EAAET,IAAIC,KAAN,EAA1C,EAAtB,EAAiF,UAACmD,QAAD,EAAc;AAC9F,OAAIjD,EAAEkD,QAAF,CAAWD,QAAX,CAAJ,EAA0B;AACzB7D,YAAQ+D,YAAR,CAAqBtD,EAArB,EAAyBG,EAAEoD,SAAF,CAAYH,QAAZ,EAAsBjD,EAAEqD,QAAxB,CAAzB,EAA4D,UAAChB,QAAD,EAAc;AACzE,SAAIA,SAASA,QAAT,IAAqB,IAArB,IAA6BA,SAASC,WAAT,IAAwB,GAAzD,EAA8D;AAC7DQ,WAAK3B,WAAL;AACA,MAFD,MAEO;AACN3B,aAAO8D,KAAP,CAAajB,SAASkB,OAAtB;AACA;AACD,KAND;AAOA;AACD,GAVD;AAWA,EAZD;AAaApE,QAAOqE,IAAP,GAAc,UAAChC,CAAD,EAAIiC,CAAJ,EAAU;AACvBA,IAAEC,eAAF;AACAlE,SAAOuD,cAAP,CAAsB,EAAE1C,OAAOlB,OAAOkB,KAAhB,EAAuB2C,OAAO,KAA9B,EAAqC1C,MAAMN,EAAE2D,KAAF,CAAQnC,CAAR,CAA3C,EAAtB,EAA+E,UAACyB,QAAD,EAAc;AAC5F,OAAIjD,EAAEkD,QAAF,CAAWD,QAAX,CAAJ,EAA0B;AACzB7D,YAAQwE,WAAR,CAAoB/D,KAAK2B,EAAE3B,EAA3B,EAA+BG,EAAEoD,SAAF,CAAYH,QAAZ,EAAsBjD,EAAEqD,QAAxB,CAA/B,EAAkE,UAAChB,QAAD,EAAc;AAC/E,SAAIA,SAASA,QAAT,IAAqB,IAArB,IAA6BA,SAASC,WAAT,IAAwB,GAAzD,EAA8D;AAC7DQ,WAAK3B,WAAL;AACA,MAFD,MAEO;AACN3B,aAAO8D,KAAP,CAAajB,SAASkB,OAAtB;AACA;AACD,KAND;AAOA;AACD,GAVD;AAWA,EAbD;;AAeApE,QAAO0E,MAAP,GAAgB,UAACC,KAAD,EAAQC,QAAR,EAAkBN,CAAlB,EAAwB;AACvCA,IAAEC,eAAF;AACAlE,SAAOwE,OAAP,CAAe,8CAA8CD,QAA9C,GAAyD,KAAxE,EAA+E,UAAC1B,QAAD,EAAc;AAC5F,OAAIA,QAAJ,EAAc;AACbjD,YAAQ6E,cAAR,CAAuBpE,KAAKiE,KAA5B,EAAmC,UAACzB,QAAD,EAAc;AAChD,SAAIA,SAASA,QAAT,IAAqB,IAArB,IAA6BA,SAASC,WAAT,IAAwB,GAAzD,EAA8D;AAC7DQ,WAAK3B,WAAL;AACA,MAFD,MAEO;AACN3B,aAAO8D,KAAP,CAAajB,SAASkB,OAAtB;AACA;AACD,KAND;AAOA;AACD,GAVD;AAWA,EAbD;;AAeA,KAAIT,OAAO,SAAPA,IAAO,CAACX,IAAD,EAAU;AACpBhD,SAAOoB,QAAP,GAAkB,IAAlB;AACApB,SAAOuB,MAAP,GAAgB,IAAhB;AACAf,YAAU,CAAV;AACAP,UAAQgD,WAAR,CAAoBvC,EAApB,EAAwBG,EAAEiC,MAAF,CAAS,EAAEvC,YAAF,EAASyC,UAAT,EAAeD,QAAQ,CAAvB,EAAT,EAAqClC,EAAEC,KAAvC,CAAxB,EAAuE,UAACoC,QAAD,EAAc;AACpF,OAAIA,SAASA,QAAT,IAAqB,IAArB,IAA6BA,SAASC,WAAT,IAAwB,GAAzD,EAA8D;AAC7DnD,WAAO+E,KAAP,GAAe/E,OAAOkB,KAAP,IAAgB,UAAhB,GAA6B,2BAA7B,GAA4D,CAAClB,OAAOkB,KAAP,IAAgB,SAAhB,GAA4B,UAA5B,GAAyClB,OAAOkB,KAAjD,IAA0D,aAA1D,GAA0EgC,SAASE,MAAT,CAAgB4B,IAA1F,GAAiG,SAA5K;AACAhF,WAAOmB,IAAP,GAAee,QAAQgB,SAASE,MAAT,CAAgBjC,IAAxB,CAAf;AACA,QAAI,CAAC+B,SAASE,MAAT,CAAgBjC,IAArB,EAA2B;AAC1BnB,YAAOuB,MAAP,GAAgBjB,UAAUiB,MAA1B,CAAkCvB,OAAOqB,OAAP,GAAiB,IAAjB;AAClC,KAFD,MAEO,IAAI6B,SAASE,MAAT,CAAgBjC,IAAhB,CAAqBc,MAArB,GAA8B1B,KAAlC,EAAyC;AAC/CP,YAAOqB,OAAP,GAAiB,IAAjB;AACA,KAFM,MAEA;AACNrB,YAAOqB,OAAP,GAAiB,KAAjB;AACA;AACDrB,WAAOoB,QAAP,GAAkB,KAAlB;AACA;AACD,GAbD;AAcA,EAlBD;;AAoBAuC;AACA,CA7JoC,CAArC","file":"locationController.js","sourcesContent":["app.controller('LocationController', ['$scope', 'fetcher', '$timeout', '$state', '$stateParams', 'dialog', 'globalVar', function ($scope, fetcher, $timeout, $state, $stateParams, dialog, globalVar) {\n    'use strict';\n\n\tlet limit\t\t= 20;\n\tlet iterate\t\t= 0;\n\tlet typeDelay\t= 500;\n\n\tlet id\t\t\t= '';\n\tlet defId\t\t= '';\n\tlet prevState\t= '';\n\tswitch (true) {\n\t\tcase !_.isNil($stateParams.province) && !_.isNil($stateParams.regency) && !_.isNil($stateParams.district):\n\t\t\tid\t= $stateParams.province + '/' + $stateParams.regency + '/' + $stateParams.district + '/';\n\t\t\t$scope.state\t= 'village'; defId = $stateParams.district; prevState = 'district';\n\t\t\tbreak;\n\t\tcase !_.isNil($stateParams.province) && !_.isNil($stateParams.regency):\n\t\t\tid\t= $stateParams.province + '/' + $stateParams.regency + '/';\n\t\t\t$scope.state\t= 'district'; defId = $stateParams.regency; prevState = 'regency';\n\t\t\tbreak;\n\t\tcase !_.isNil($stateParams.province):\n\t\t\tid\t= $stateParams.province + '/';\n\t\t\t$scope.state\t= 'regency';  defId = $stateParams.province; prevState = 'province';\n\t\t\tbreak;\n\t\tdefault:\n\t\t\t$scope.state\t= 'province';\n\t}\n\n\t$scope.data\t\t= [];\n\t$scope.pauseAjx\t= false;\n\t$scope.doneAjx\t= false;\n\n\t$scope.search\t= \"\";\n\t$scope.nodata\t= null;\n\t$scope.loading\t= globalVar.loading;\n\n\t$scope.gotoLocation\t= (id) => {\n\t\tlet newLocation\t= { };\n\t\tnewLocation[$scope.state]\t= id;\n\n\t\t$state.go('dashboard.location', _.assign({}, _.omit($stateParams, ['#']), newLocation));\n\t}\n\n\t$scope.backLocation\t= () => {\n\t\tlet currentLocation\t= { };\n\t\tcurrentLocation[prevState]\t= null;\n\n\t\t$state.go('dashboard.location', _.assign({}, _.omit($stateParams, ['#']), currentLocation));\n\t}\n\n\tlet getSearch\t= () => ($scope.search ? (($scope.search.length >= 3) ? $scope.search : null) : null);\n\n\tlet mapName\t= (data) => (\n\t\t_.chain(data).map((o) => (\n\t\t\t_.chain(o).pickBy((d, key) => ( _.includes(['id'], key) || _.startsWith(key, 'name') )).mapKeys((d, key) => (key == 'id' ? 'id' : 'name')).value()\n\t\t)).value()\n\t);\n\n\t$scope.loadMoar\t= () => {\n\t\t$scope.pauseAjx\t= true;\n\t\titerate++;\n\t\tlet data = _.omitBy({\n\t\t\tlimit,\n\t\t\toffset: iterate * limit,\n\t\t\tlike: getSearch()\n\t\t}, _.isNil);\n\t\tfetcher.getLocation(id, data, (response) => {\n\t\t\tif (response.response == 'OK' && response.status_code == 200 && response.result.data) {\n\t\t\t\tif (response.result.data.length < limit) { $scope.doneAjx = true; }\n\t\t\t\t$scope.data \t= _.concat($scope.data, mapName(response.result.data));\n\t\t\t} else {\n\t\t\t\t$scope.doneAjx\t= true;\n\t\t\t}\n\t\t\t$scope.pauseAjx\t= false;\n\t\t});\n\t};\n\n\tlet delayTimeout;\n\t$scope.$watch('search', (newVal, oldVal) => {\n\t\tif (!_.isNil(newVal) && newVal !== oldVal) {\n\t\t\tif (delayTimeout) $timeout.cancel(delayTimeout);\n\n\t\t\tdelayTimeout\t= $timeout(() => {\n\t\t\t\tif (newVal.length >= 3) {\n\t\t\t\t\tinit(newVal);\n\t\t\t\t} else if (newVal == '' && !$scope.pauseAjx) {\n\t\t\t\t\tinit();\n\t\t\t\t}\n\t\t\t}, typeDelay);\n\t\t} else {\n\t\t\t$scope.search = '';\n\t\t}\n\t});\n\n\t$scope.newLocation\t= () => {\n\t\tdialog.locationDialog({ state: $scope.state, isNew: true, data: { id: defId } }, (dialResp) => {\n\t\t\tif (_.isObject(dialResp)) {\n\t\t\t\tfetcher.postLocation(id, _.mapValues(dialResp, _.toString), (response) => {\n\t\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\t\tinit(getSearch());\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdialog.error(response.message);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\t$scope.edit\t= (o, e) => {\n\t\te.stopPropagation();\n\t\tdialog.locationDialog({ state: $scope.state, isNew: false, data: _.clone(o) }, (dialResp) => {\n\t\t\tif (_.isObject(dialResp)) {\n\t\t\t\tfetcher.putLocation(id + o.id, _.mapValues(dialResp, _.toString), (response) => {\n\t\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\t\tinit(getSearch());\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdialog.error(response.message);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\n\t$scope.delete\t= (locId, question, e) => {\n\t\te.stopPropagation();\n\t\tdialog.confirm('Are you sure you wanna delete location \\\"' + question + '\\\"?', (response) => {\n\t\t\tif (response) {\n\t\t\t\tfetcher.deleteLocation(id + locId, (response) => {\n\t\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\t\tinit(getSearch());\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdialog.error(response.message);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tlet init = (like) => {\n\t\t$scope.pauseAjx\t= true;\n\t\t$scope.nodata\t= null;\n\t\titerate\t= 0;\n\t\tfetcher.getLocation(id, _.omitBy({ limit, like, offset: 0 }, _.isNil), (response) => {\n\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t$scope.title\t= $scope.state == 'province' ? '<span>all</span> province' : (($scope.state == 'regency' ? 'regencie' : $scope.state) + 's <span>of ' + response.result.name + '</span>');\n\t\t\t\t$scope.data\t\t= mapName(response.result.data);\n\t\t\t\tif (!response.result.data) {\n\t\t\t\t\t$scope.nodata = globalVar.nodata; $scope.doneAjx = true;\n\t\t\t\t} else if (response.result.data.length < limit) {\n\t\t\t\t\t$scope.doneAjx = true;\n\t\t\t\t} else {\n\t\t\t\t\t$scope.doneAjx\t= false;\n\t\t\t\t}\n\t\t\t\t$scope.pauseAjx\t= false;\n\t\t\t}\n\t\t});\n\t}\n\n\tinit();\n}]);\n"]}