{"version":3,"sources":["../../../js/dashboard/locationController.js"],"names":["app","controller","$scope","fetcher","$timeout","$state","$stateParams","dialog","globalVar","limit","iterate","typeDelay","id","defId","prevState","locMap","province","regency","district","village","downloadLink","getFilesLink","_","pickBy","o","key","includes","isNil","openHint","notif","locationHint","state","data","pauseAjx","doneAjx","search","nodata","loading","gotoLocation","newLocation","go","assign","omit","backLocation","currentLocation","getSearch","length","mapName","chain","map","d","startsWith","mapKeys","value","loadMoar","omitBy","offset","like","getLocation","response","status_code","result","concat","delayTimeout","$watch","newVal","oldVal","cancel","init","locationDialog","isNew","dialResp","isObject","postLocation","mapValues","toString","error","message","edit","e","stopPropagation","clone","putLocation","delete","locId","location","confirm","deleteLocation","title","name"],"mappings":"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","file":"locationController.js","sourcesContent":["app.controller('LocationController', ['$scope', 'fetcher', '$timeout', '$state', '$stateParams', 'dialog', 'globalVar', function ($scope, fetcher, $timeout, $state, $stateParams, dialog, globalVar) {\n    'use strict';\n\n\tlet limit\t\t= 20;\n\tlet iterate\t\t= 0;\n\tlet typeDelay\t= 500;\n\n\tlet id\t\t\t= '';\n\tlet defId\t\t= '';\n\tlet prevState\t= '';\n\n\t// let hint\t\t= '<i class=\"fa fa-question-circle-o cursor-pointer\" aria-hidden=\"true\"><md-tooltip md-autohide=\"true\">petunjuk penggunaan halaman</md-tooltip></i>';\n\t$scope.locMap\t= { province : 'provinsi', regency: 'kabupaten', district: 'kecamatan', village: 'desa' };\n\n\t$scope.downloadLink\t= () => (fetcher.getFilesLink('locationdata', _.pickBy($stateParams, (o, key) => (_.includes(['province', 'regency', 'district'], key) && !_.isNil(o)))));\n\n\t$scope.openHint\t= () => { dialog.notif(globalVar.locationHint); }\n\n\tswitch (true) {\n\t\tcase !_.isNil($stateParams.province) && !_.isNil($stateParams.regency) && !_.isNil($stateParams.district):\n\t\t\tid\t= $stateParams.province + '/' + $stateParams.regency + '/' + $stateParams.district + '/';\n\t\t\t$scope.state\t= 'village'; defId = $stateParams.district; prevState = 'district';\n\t\t\tbreak;\n\t\tcase !_.isNil($stateParams.province) && !_.isNil($stateParams.regency):\n\t\t\tid\t= $stateParams.province + '/' + $stateParams.regency + '/';\n\t\t\t$scope.state\t= 'district'; defId = $stateParams.regency; prevState = 'regency';\n\t\t\tbreak;\n\t\tcase !_.isNil($stateParams.province):\n\t\t\tid\t= $stateParams.province + '/';\n\t\t\t$scope.state\t= 'regency';  defId = $stateParams.province; prevState = 'province';\n\t\t\tbreak;\n\t\tdefault:\n\t\t\t$scope.state\t= 'province';\n\t}\n\n\t$scope.data\t\t= [];\n\t$scope.pauseAjx\t= false;\n\t$scope.doneAjx\t= false;\n\n\t$scope.search\t= \"\";\n\t$scope.nodata\t= null;\n\t$scope.loading\t= globalVar.loading;\n\n\t$scope.gotoLocation\t= (id) => {\n\t\tlet newLocation\t= { };\n\t\tnewLocation[$scope.state]\t= id;\n\n\t\t$state.go('dashboard.location', _.assign({}, _.omit($stateParams, ['#']), newLocation));\n\t}\n\n\t$scope.backLocation\t= () => {\n\t\tlet currentLocation\t= { };\n\t\tcurrentLocation[prevState]\t= null;\n\n\t\t$state.go('dashboard.location', _.assign({}, _.omit($stateParams, ['#']), currentLocation));\n\t}\n\n\tlet getSearch\t= () => ($scope.search ? (($scope.search.length >= 3) ? $scope.search : null) : null);\n\n\tlet mapName\t= (data) => (\n\t\t_.chain(data).map((o) => (\n\t\t\t_.chain(o).pickBy((d, key) => ( _.includes(['id'], key) || _.startsWith(key, 'name') )).mapKeys((d, key) => (key == 'id' ? 'id' : 'name')).value()\n\t\t)).value()\n\t);\n\n\t$scope.loadMoar\t= () => {\n\t\t$scope.pauseAjx\t= true;\n\t\titerate++;\n\t\tlet data = _.omitBy({\n\t\t\tlimit,\n\t\t\toffset: iterate * limit,\n\t\t\tlike: getSearch()\n\t\t}, _.isNil);\n\t\tfetcher.getLocation(id, data, (response) => {\n\t\t\tif (response.response == 'OK' && response.status_code == 200 && response.result.data) {\n\t\t\t\tif (response.result.data.length < limit) { $scope.doneAjx = true; }\n\t\t\t\t$scope.data \t= _.concat($scope.data, mapName(response.result.data));\n\t\t\t} else {\n\t\t\t\t$scope.doneAjx\t= true;\n\t\t\t}\n\t\t\t$scope.pauseAjx\t= false;\n\t\t});\n\t};\n\n\tlet delayTimeout;\n\t$scope.$watch('search', (newVal, oldVal) => {\n\t\tif (!_.isNil(newVal) && newVal !== oldVal) {\n\t\t\tif (delayTimeout) $timeout.cancel(delayTimeout);\n\n\t\t\tdelayTimeout\t= $timeout(() => {\n\t\t\t\tif (newVal.length >= 3) {\n\t\t\t\t\tinit(newVal);\n\t\t\t\t} else if (newVal == '' && !$scope.pauseAjx) {\n\t\t\t\t\tinit();\n\t\t\t\t}\n\t\t\t}, typeDelay);\n\t\t} else {\n\t\t\t$scope.search = '';\n\t\t}\n\t});\n\n\t$scope.newLocation\t= () => {\n\t\tdialog.locationDialog({ state: $scope.locMap[$scope.state], isNew: true, data: { id: defId } }, (dialResp) => {\n\t\t\tif (_.isObject(dialResp)) {\n\t\t\t\tfetcher.postLocation(id, _.mapValues(dialResp, _.toString), (response) => {\n\t\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\t\tinit(getSearch());\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdialog.error(response.message);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\t$scope.edit\t= (o, e) => {\n\t\te.stopPropagation();\n\t\tdialog.locationDialog({ state: $scope.locMap[$scope.state], isNew: false, data: _.clone(o) }, (dialResp) => {\n\t\t\tif (_.isObject(dialResp)) {\n\t\t\t\tfetcher.putLocation(id + o.id, _.mapValues(dialResp, _.toString), (response) => {\n\t\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\t\tinit(getSearch());\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdialog.error(response.message);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\n\t$scope.delete\t= (locId, location, e) => {\n\t\te.stopPropagation();\n\t\tdialog.confirm('Apakah anda yakin akan menghapus \\\"' + location + '\\\"?', (response) => {\n\t\t\tif (response) {\n\t\t\t\tfetcher.deleteLocation(id + locId, (response) => {\n\t\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\t\tinit(getSearch());\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdialog.error(response.message);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tlet init = (like) => {\n\t\t$scope.pauseAjx\t= true;\n\t\t$scope.nodata\t= null;\n\t\titerate\t= 0;\n\t\tfetcher.getLocation(id, _.omitBy({ limit, like, offset: 0 }, _.isNil), (response) => {\n\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t$scope.title\t= ($scope.state == 'province' ? '<span>semua</span> provinsi' : ($scope.locMap[$scope.state] + ' <span>di ' + response.result.name + '</span>'));\n\t\t\t\t$scope.data\t\t= mapName(response.result.data);\n\t\t\t\tif (!response.result.data) {\n\t\t\t\t\t$scope.nodata = globalVar.nodata; $scope.doneAjx = true;\n\t\t\t\t} else if (response.result.data.length < limit) {\n\t\t\t\t\t$scope.doneAjx = true;\n\t\t\t\t} else {\n\t\t\t\t\t$scope.doneAjx\t= false;\n\t\t\t\t}\n\t\t\t\t$scope.pauseAjx\t= false;\n\t\t\t}\n\t\t});\n\t}\n\n\tinit();\n}]);\n"]}