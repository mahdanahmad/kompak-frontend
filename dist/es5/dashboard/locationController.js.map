{"version":3,"sources":["../../../js/dashboard/locationController.js"],"names":["app","controller","$scope","fetcher","$timeout","$state","$stateParams","dialog","globalVar","limit","iterate","typeDelay","id","defId","prevState","locMap","province","regency","district","village","_","isNil","state","data","pauseAjx","doneAjx","search","nodata","loading","gotoLocation","newLocation","go","assign","omit","backLocation","currentLocation","getSearch","length","mapName","chain","map","o","pickBy","d","key","includes","startsWith","mapKeys","value","loadMoar","omitBy","offset","like","getLocation","response","status_code","result","concat","delayTimeout","$watch","newVal","oldVal","cancel","init","locationDialog","isNew","dialResp","isObject","postLocation","mapValues","toString","error","message","edit","e","stopPropagation","clone","putLocation","delete","locId","location","confirm","deleteLocation","title","name"],"mappings":"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","file":"locationController.js","sourcesContent":["app.controller('LocationController', ['$scope', 'fetcher', '$timeout', '$state', '$stateParams', 'dialog', 'globalVar', function ($scope, fetcher, $timeout, $state, $stateParams, dialog, globalVar) {\n    'use strict';\n\n\tlet limit\t\t= 20;\n\tlet iterate\t\t= 0;\n\tlet typeDelay\t= 500;\n\n\tlet id\t\t\t= '';\n\tlet defId\t\t= '';\n\tlet prevState\t= '';\n\n\t$scope.locMap\t= { province : 'provinsi', regency: 'kabupaten', district: 'kecamatan', village: 'desa' };\n\n\tswitch (true) {\n\t\tcase !_.isNil($stateParams.province) && !_.isNil($stateParams.regency) && !_.isNil($stateParams.district):\n\t\t\tid\t= $stateParams.province + '/' + $stateParams.regency + '/' + $stateParams.district + '/';\n\t\t\t$scope.state\t= 'village'; defId = $stateParams.district; prevState = 'district';\n\t\t\tbreak;\n\t\tcase !_.isNil($stateParams.province) && !_.isNil($stateParams.regency):\n\t\t\tid\t= $stateParams.province + '/' + $stateParams.regency + '/';\n\t\t\t$scope.state\t= 'district'; defId = $stateParams.regency; prevState = 'regency';\n\t\t\tbreak;\n\t\tcase !_.isNil($stateParams.province):\n\t\t\tid\t= $stateParams.province + '/';\n\t\t\t$scope.state\t= 'regency';  defId = $stateParams.province; prevState = 'province';\n\t\t\tbreak;\n\t\tdefault:\n\t\t\t$scope.state\t= 'province';\n\t}\n\n\t$scope.data\t\t= [];\n\t$scope.pauseAjx\t= false;\n\t$scope.doneAjx\t= false;\n\n\t$scope.search\t= \"\";\n\t$scope.nodata\t= null;\n\t$scope.loading\t= globalVar.loading;\n\n\t$scope.gotoLocation\t= (id) => {\n\t\tlet newLocation\t= { };\n\t\tnewLocation[$scope.state]\t= id;\n\n\t\t$state.go('dashboard.location', _.assign({}, _.omit($stateParams, ['#']), newLocation));\n\t}\n\n\t$scope.backLocation\t= () => {\n\t\tlet currentLocation\t= { };\n\t\tcurrentLocation[prevState]\t= null;\n\n\t\t$state.go('dashboard.location', _.assign({}, _.omit($stateParams, ['#']), currentLocation));\n\t}\n\n\tlet getSearch\t= () => ($scope.search ? (($scope.search.length >= 3) ? $scope.search : null) : null);\n\n\tlet mapName\t= (data) => (\n\t\t_.chain(data).map((o) => (\n\t\t\t_.chain(o).pickBy((d, key) => ( _.includes(['id'], key) || _.startsWith(key, 'name') )).mapKeys((d, key) => (key == 'id' ? 'id' : 'name')).value()\n\t\t)).value()\n\t);\n\n\t$scope.loadMoar\t= () => {\n\t\t$scope.pauseAjx\t= true;\n\t\titerate++;\n\t\tlet data = _.omitBy({\n\t\t\tlimit,\n\t\t\toffset: iterate * limit,\n\t\t\tlike: getSearch()\n\t\t}, _.isNil);\n\t\tfetcher.getLocation(id, data, (response) => {\n\t\t\tif (response.response == 'OK' && response.status_code == 200 && response.result.data) {\n\t\t\t\tif (response.result.data.length < limit) { $scope.doneAjx = true; }\n\t\t\t\t$scope.data \t= _.concat($scope.data, mapName(response.result.data));\n\t\t\t} else {\n\t\t\t\t$scope.doneAjx\t= true;\n\t\t\t}\n\t\t\t$scope.pauseAjx\t= false;\n\t\t});\n\t};\n\n\tlet delayTimeout;\n\t$scope.$watch('search', (newVal, oldVal) => {\n\t\tif (!_.isNil(newVal) && newVal !== oldVal) {\n\t\t\tif (delayTimeout) $timeout.cancel(delayTimeout);\n\n\t\t\tdelayTimeout\t= $timeout(() => {\n\t\t\t\tif (newVal.length >= 3) {\n\t\t\t\t\tinit(newVal);\n\t\t\t\t} else if (newVal == '' && !$scope.pauseAjx) {\n\t\t\t\t\tinit();\n\t\t\t\t}\n\t\t\t}, typeDelay);\n\t\t} else {\n\t\t\t$scope.search = '';\n\t\t}\n\t});\n\n\t$scope.newLocation\t= () => {\n\t\tdialog.locationDialog({ state: $scope.locMap[$scope.state], isNew: true, data: { id: defId } }, (dialResp) => {\n\t\t\tif (_.isObject(dialResp)) {\n\t\t\t\tfetcher.postLocation(id, _.mapValues(dialResp, _.toString), (response) => {\n\t\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\t\tinit(getSearch());\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdialog.error(response.message);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\t$scope.edit\t= (o, e) => {\n\t\te.stopPropagation();\n\t\tdialog.locationDialog({ state: $scope.locMap[$scope.state], isNew: false, data: _.clone(o) }, (dialResp) => {\n\t\t\tif (_.isObject(dialResp)) {\n\t\t\t\tfetcher.putLocation(id + o.id, _.mapValues(dialResp, _.toString), (response) => {\n\t\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\t\tinit(getSearch());\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdialog.error(response.message);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\n\t$scope.delete\t= (locId, location, e) => {\n\t\te.stopPropagation();\n\t\tdialog.confirm('Apakah anda yakin akan menghapus \\\"' + location + '\\\"?', (response) => {\n\t\t\tif (response) {\n\t\t\t\tfetcher.deleteLocation(id + locId, (response) => {\n\t\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\t\tinit(getSearch());\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdialog.error(response.message);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tlet init = (like) => {\n\t\t$scope.pauseAjx\t= true;\n\t\t$scope.nodata\t= null;\n\t\titerate\t= 0;\n\t\tfetcher.getLocation(id, _.omitBy({ limit, like, offset: 0 }, _.isNil), (response) => {\n\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t$scope.title\t= $scope.state == 'province' ? '<span>semua</span> provinsi' : ($scope.locMap[$scope.state] + ' <span>di ' + response.result.name + '</span>');\n\t\t\t\t$scope.data\t\t= mapName(response.result.data);\n\t\t\t\tif (!response.result.data) {\n\t\t\t\t\t$scope.nodata = globalVar.nodata; $scope.doneAjx = true;\n\t\t\t\t} else if (response.result.data.length < limit) {\n\t\t\t\t\t$scope.doneAjx = true;\n\t\t\t\t} else {\n\t\t\t\t\t$scope.doneAjx\t= false;\n\t\t\t\t}\n\t\t\t\t$scope.pauseAjx\t= false;\n\t\t\t}\n\t\t});\n\t}\n\n\tinit();\n}]);\n"]}