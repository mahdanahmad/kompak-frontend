{"version":3,"sources":["../../../js/dashboard/logsController.js"],"names":["app","controller","$scope","fetcher","$timeout","dialog","globalVar","limit","iterate","typeDelay","data","pauseAjx","doneAjx","search","nodata","loading","getSearch","length","openHint","notif","choicesHint","toDate","stringDate","moment","format","stateOptions","title","value","state","_","head","selectState","selected","init","loadMoar","omitBy","offset","like","category","id","isNil","getLogs","response","status_code","result","concat","delayTimeout","$watch","newVal","oldVal","cancel"],"mappings":"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","file":"logsController.js","sourcesContent":["app.controller('LogsController', ['$scope', 'fetcher', '$timeout', 'dialog', 'globalVar', function ($scope, fetcher, $timeout, dialog, globalVar) {\n    'use strict';\n\n\tlet limit\t\t= 15;\n\tlet iterate\t\t= 0;\n\tlet typeDelay\t= 500;\n\n\t$scope.data\t\t= [];\n\t$scope.pauseAjx\t= false;\n\t$scope.doneAjx\t= false;\n\n\t$scope.search\t= \"\";\n\t$scope.nodata\t= null;\n\t$scope.loading\t= globalVar.loading;\n\n\tlet getSearch\t= () => ($scope.search ? (($scope.search.length >= 3) ? $scope.search : null) : null);\n\n\t$scope.openHint\t= () => { dialog.notif(globalVar.choicesHint); }\n\t$scope.toDate\t= (stringDate) => (moment(stringDate).format(\"dddd, Do MMMM YYYY, hh:mm\"));\n\n\t$scope.stateOptions\t= [\n\t\t{ title: 'semua', value: null },\n\t\t{ title: 'insert', value: 'INSERT' },\n\t\t{ title: 'update', value: 'UPDATE' },\n\t\t{ title: 'delete', value: 'DELETE' },\n\t];\n\t$scope.state\t\t= _.head($scope.stateOptions);\n\t$scope.selectState\t= (selected) => { $scope.state = selected; init(getSearch()); }\n\n\t$scope.loadMoar\t= () => {\n\t\t$scope.pauseAjx\t= true;\n\t\titerate++;\n\t\tlet data = _.omitBy({\n\t\t\tlimit,\n\t\t\toffset: iterate * limit,\n\t\t\tlike: getSearch(),\n\t\t\tcategory: $scope.category.id\n\t\t}, _.isNil);\n\t\tfetcher.getLogs(data, (response) => {\n\t\t\tif (response.response == 'OK' && response.status_code == 200 && response.result) {\n\t\t\t\tif (response.result.length < limit) { $scope.doneAjx = true; }\n\t\t\t\t$scope.data \t= _.concat($scope.data, response.result);\n\t\t\t} else {\n\t\t\t\t$scope.doneAjx\t= true;\n\t\t\t}\n\t\t\t$scope.pauseAjx\t= false;\n\t\t});\n\t};\n\n\tlet delayTimeout;\n\t$scope.$watch('search', (newVal, oldVal) => {\n\t\tif (!_.isNil(newVal) && newVal !== oldVal) {\n\t\t\tif (delayTimeout) $timeout.cancel(delayTimeout);\n\n\t\t\tdelayTimeout\t= $timeout(() => {\n\t\t\t\tif (newVal.length >= 3) {\n\t\t\t\t\tinit(newVal);\n\t\t\t\t} else if (newVal == '' && !$scope.pauseAjx) {\n\t\t\t\t\tinit();\n\t\t\t\t}\n\t\t\t}, typeDelay);\n\t\t} else {\n\t\t\t$scope.search = '';\n\t\t}\n\t});\n\n\tlet init = (like) => {\n\t\t$scope.pauseAjx\t= true;\n\t\t$scope.nodata\t= null;\n\t\titerate\t= 0;\n\t\tfetcher.getLogs(_.omitBy({ limit, like, offset: 0, state: $scope.state.value }, _.isNil), (response) => {\n\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t$scope.data\t= response.result;\n\t\t\t\tif (!response.result || response.result.length == 0) {\n\t\t\t\t\t$scope.nodata = globalVar.nodata; $scope.doneAjx = true;\n\t\t\t\t} else  if (response.result.length < limit) {\n\t\t\t\t\t$scope.doneAjx = true;\n\t\t\t\t} else {\n\t\t\t\t\t$scope.doneAjx\t= false;\n\t\t\t\t}\n\t\t\t\t$scope.pauseAjx\t= false;\n\t\t\t}\n\t\t});\n\t}\n\n\tinit();\n}]);\n"]}