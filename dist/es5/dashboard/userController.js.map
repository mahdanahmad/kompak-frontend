{"version":3,"sources":["../../../js/dashboard/userController.js"],"names":["app","controller","$scope","fetcher","$timeout","dialog","globalVar","limit","iterate","typeDelay","search","nodata","loading","data","pauseAjx","doneAjx","startDate","moment","year","startOf","toDate","endDate","dateChange","init","downloadLink","getFilesLink","_","omitBy","startdate","format","dateFormat","enddate","like","getSearch","orderby","value","order","isNil","length","openHint","notif","userHint","loadMoar","offset","getAllUser","response","status_code","result","concat","toYear","birthyear","diff","delayTimeout","$watch","newVal","oldVal","cancel","orderOptions","title","head","selectSort","selected","newUser","userDialog","dialResp","isObject","postUser","mapValues","toString","editUser","id","async","waterfall","callback","getUser","message","userData","before","clone","isEqual","err","console","log","putUser","ID","chain","omit","delete","name","e","stopPropagation","confirm","deleteUser"],"mappings":";;AAAAA,IAAIC,UAAJ,CAAe,gBAAf,EAAiC,CAAC,QAAD,EAAW,SAAX,EAAsB,UAAtB,EAAkC,QAAlC,EAA4C,WAA5C,EAAyD,UAAUC,MAAV,EAAkBC,OAAlB,EAA2BC,QAA3B,EAAqCC,MAArC,EAA6CC,SAA7C,EAAwD;AAC9I;;AAEH,KAAIC,QAAS,EAAb;AACA,KAAIC,UAAW,CAAf;AACA,KAAIC,YAAY,GAAhB;;AAEAP,QAAOQ,MAAP,GAAgB,EAAhB;AACAR,QAAOS,MAAP,GAAgB,IAAhB;AACAT,QAAOU,OAAP,GAAiBN,UAAUM,OAA3B;;AAEAV,QAAOW,IAAP,GAAe,EAAf;AACAX,QAAOY,QAAP,GAAkB,KAAlB;AACAZ,QAAOa,OAAP,GAAiB,KAAjB;;AAEAb,QAAOc,SAAP,GAAmBC,SAASC,IAAT,CAAc,IAAd,EAAoBC,OAApB,CAA4B,MAA5B,EAAoCC,MAApC,EAAnB;AACAlB,QAAOmB,OAAP,GAAkBJ,SAASG,MAAT,EAAlB;AACAlB,QAAOoB,UAAP,GAAoB,YAAM;AAAEC;AAAS,EAArC;AACArB,QAAOsB,YAAP,GAAsB;AAAA,SAAOrB,QAAQsB,YAAR,CAAqB,UAArB,EAAiCC,EAAEC,MAAF,CAAS;AACtEC,cAAWX,OAAOf,OAAOc,SAAd,EAAyBa,MAAzB,CAAgCvB,UAAUwB,UAA1C,CAD2D;AAEtEC,YAASd,OAAOf,OAAOmB,OAAd,EAAuBQ,MAAvB,CAA8BvB,UAAUwB,UAAxC,CAF6D;AAGtEE,SAAMC,WAHgE;AAItEC,YAAShC,OAAOgC,OAAP,CAAeC,KAAf,GAAuB,GAAvB,GAA6BjC,OAAOgC,OAAP,CAAeE;AAJiB,GAAT,EAK3DV,EAAEW,KALyD,CAAjC,CAAP;AAAA,EAAtB;;AAOA,KAAIJ,YAAY,SAAZA,SAAY;AAAA,SAAO/B,OAAOQ,MAAP,GAAkBR,OAAOQ,MAAP,CAAc4B,MAAd,IAAwB,CAAzB,GAA8BpC,OAAOQ,MAArC,GAA8C,IAA/D,GAAuE,IAA9E;AAAA,EAAhB;;AAEAR,QAAOqC,QAAP,GAAkB,YAAM;AAAElC,SAAOmC,KAAP,CAAalC,UAAUmC,QAAvB;AAAmC,EAA7D;;AAEAvC,QAAOwC,QAAP,GAAkB,YAAM;AACvBxC,SAAOY,QAAP,GAAkB,IAAlB;AACAN;AACA,MAAIK,OAAOa,EAAEC,MAAF,CAAS;AACnBpB,eADmB;AAEnBoC,WAAQnC,UAAUD,KAFC;AAGnByB,SAAMC,WAHa;AAInBC,YAAShC,OAAOgC,OAAP,CAAeC,KAAf,GAAuB,GAAvB,GAA6BjC,OAAOgC,OAAP,CAAeE,KAJlC;AAKnBR,cAAWX,OAAOf,OAAOc,SAAd,EAAyBa,MAAzB,CAAgCvB,UAAUwB,UAA1C,CALQ;AAMnBC,YAASd,OAAOf,OAAOmB,OAAd,EAAuBQ,MAAvB,CAA8BvB,UAAUwB,UAAxC;AANU,GAAT,EAORJ,EAAEW,KAPM,CAAX;AAQAlC,UAAQyC,UAAR,CAAmB/B,IAAnB,EAAyB,UAACgC,QAAD,EAAc;AACtC,OAAIA,SAASA,QAAT,IAAqB,IAArB,IAA6BA,SAASC,WAAT,IAAwB,GAArD,IAA4DD,SAASE,MAAzE,EAAiF;AAChF,QAAIF,SAASE,MAAT,CAAgBT,MAAhB,GAAyB/B,KAA7B,EAAoC;AAAEL,YAAOa,OAAP,GAAiB,IAAjB;AAAwB;AAC9Db,WAAOW,IAAP,GAAea,EAAEsB,MAAF,CAAS9C,OAAOW,IAAhB,EAAsBgC,SAASE,MAA/B,CAAf;AACA,IAHD,MAGO;AACN7C,WAAOa,OAAP,GAAiB,IAAjB;AACA;AACDb,UAAOY,QAAP,GAAkB,KAAlB;AACA,GARD;AASA,EApBD;;AAsBAZ,QAAO+C,MAAP,GAAgB,UAACC,SAAD;AAAA,SAAiBA,YAAYjC,SAASY,MAAT,CAAgB,MAAhB,CAAZ,GAAsCZ,SAASkC,IAAT,CAAclC,SAASC,IAAT,CAAcgC,SAAd,CAAd,EAAwC,OAAxC,CAAtC,GAAyF,IAA1G;AAAA,EAAhB;;AAEA,KAAIE,qBAAJ;AACAlD,QAAOmD,MAAP,CAAc,QAAd,EAAwB,UAACC,MAAD,EAASC,MAAT,EAAoB;AAC3C,MAAI,CAAC7B,EAAEW,KAAF,CAAQiB,MAAR,CAAD,IAAoBA,WAAWC,MAAnC,EAA2C;AAC1C,OAAIH,YAAJ,EAAkBhD,SAASoD,MAAT,CAAgBJ,YAAhB;;AAElBA,kBAAehD,SAAS,YAAM;AAC7B,QAAIkD,OAAOhB,MAAP,IAAiB,CAArB,EAAwB;AACvBf,UAAK+B,MAAL;AACA,KAFD,MAEO,IAAIA,UAAU,EAAV,IAAgB,CAACpD,OAAOY,QAA5B,EAAsC;AAC5CS;AACA;AACD,IANc,EAMZd,SANY,CAAf;AAOA,GAVD,MAUO;AACNP,UAAOQ,MAAP,GAAgB,EAAhB;AACA;AACD,EAdD;;AAgBAR,QAAOuD,YAAP,GAAsB,CACrB,EAAEC,OAAO,MAAT,EAAiBvB,OAAO,kBAAxB,EAA4CC,OAAO,KAAnD,EADqB,EAErB,EAAEsB,OAAO,SAAT,EAAoBvB,OAAO,iBAA3B,EAA8CC,OAAO,KAArD,EAFqB,EAGrB,EAAEsB,OAAO,MAAT,EAAiBvB,OAAO,aAAxB,EAAuCC,OAAO,KAA9C,EAHqB,EAIrB,EAAEsB,OAAO,MAAT,EAAiBvB,OAAO,eAAxB,EAAyCC,OAAO,KAAhD,EAJqB,EAKrB,EAAEsB,OAAO,MAAT,EAAiBvB,OAAO,WAAxB,EAAqCC,OAAO,KAA5C,EALqB,EAMrB,EAAEsB,OAAO,YAAT,EAAuBvB,OAAO,kBAA9B,EAAkDC,OAAO,KAAzD,EANqB,CAAtB;;AASAlC,QAAOgC,OAAP,GAAkBR,EAAEiC,IAAF,CAAOzD,OAAOuD,YAAd,CAAlB;AACAvD,QAAO0D,UAAP,GAAoB,UAACC,QAAD,EAAc;AACjC,MAAI3D,OAAOgC,OAAP,CAAewB,KAAf,IAAwBG,SAASH,KAArC,EAA4C;AAC3CG,YAASzB,KAAT,GAAiByB,SAASzB,KAAT,IAAkB,KAAlB,GAA0B,MAA1B,GAAmC,KAApD;AACA,GAFD,MAEO;AACNyB,YAASzB,KAAT,GAAiB,KAAjB;AACA;;AAEDlC,SAAOgC,OAAP,GAAiB2B,QAAjB;;AAEAtC,OAAKU,WAAL;AACA,EAVD;;AAYA/B,QAAO4D,OAAP,GAAiB,YAAM;AACtBzD,SAAO0D,UAAP,CAAkB,EAAlB,EAAsB,UAACC,QAAD,EAAc;AACnC,OAAItC,EAAEuC,QAAF,CAAWD,QAAX,CAAJ,EAA0B;AACzB7D,YAAQ+D,QAAR,CAAiBxC,EAAEyC,SAAF,CAAYH,QAAZ,EAAsBtC,EAAE0C,QAAxB,CAAjB,EAAoD,UAACvB,QAAD,EAAc;AACjE,SAAIA,SAASA,QAAT,IAAqB,IAArB,IAA6BA,SAASC,WAAT,IAAwB,GAAzD,EAA8D;AAC7DvB,WAAKU,WAAL;AACA;AACD,KAJD;AAKA;AACD,GARD;AASA,EAVD;AAWA/B,QAAOmE,QAAP,GAAkB,UAACC,EAAD,EAAQ;AACzBC,QAAMC,SAAN,CAAgB,CACf,UAACC,QAAD,EAAc;AACbtE,WAAQuE,OAAR,CAAgBJ,EAAhB,EAAoB,UAACzB,QAAD,EAAc;AACjC,QAAIA,SAASA,QAAT,IAAqB,IAArB,IAA6BA,SAASC,WAAT,IAAwB,GAAzD,EAA8D;AAC7D2B,cAAS,IAAT,EAAe5B,SAASE,MAAxB;AACA,KAFD,MAEO;AACN0B,cAAS5B,SAAS8B,OAAlB;AACA;AACD,IAND;AAOA,GATc,EAUf,UAACC,QAAD,EAAWH,QAAX,EAAwB;AACvB,OAAII,SAASnD,EAAEoD,KAAF,CAAQF,QAAR,CAAb;AACAvE,UAAO0D,UAAP,CAAkBa,QAAlB,EAA4B,UAAC/B,QAAD,EAAc;AACzC,QAAInB,EAAEuC,QAAF,CAAWpB,QAAX,KAAwB,CAACnB,EAAEqD,OAAF,CAAUF,MAAV,EAAkBhC,QAAlB,CAA7B,EAA0D;AACzD4B,cAAS,IAAT,EAAe5B,QAAf;AACA,KAFD,MAEO;AACN4B,cAAS,IAAT;AACA;AACD,IAND;AAOA,GAnBc,CAAhB,EAoBG,UAACO,GAAD,EAAMjC,MAAN,EAAiB;AACnB,OAAIiC,GAAJ,EAAS;AAAEC,YAAQC,GAAR,CAAYF,GAAZ;AAAmB;;AAE9B,OAAIjC,MAAJ,EAAY;AACX5C,YAAQgF,OAAR,CAAgBpC,OAAOqC,EAAvB,EAA2B1D,EAAE2D,KAAF,CAAQtC,MAAR,EAAgBoB,SAAhB,CAA0BzC,EAAE0C,QAA5B,EAAsCkB,IAAtC,CAA2C,CAAC,gBAAD,EAAmB,WAAnB,CAA3C,EAA4EnD,KAA5E,EAA3B,EAAgH,UAACU,QAAD,EAAc;AAC7H,SAAIA,SAASA,QAAT,IAAqB,IAArB,IAA6BA,SAASC,WAAT,IAAwB,GAAzD,EAA8D;AAC7DvB,WAAKU,WAAL;AACA;AACD,KAJD;AAKA;AACD,GA9BD;AA+BA,EAhCD;;AAkCA/B,QAAOqF,MAAP,GAAgB,UAACjB,EAAD,EAAKkB,IAAL,EAAWC,CAAX,EAAiB;AAChCA,IAAEC,eAAF;AACArF,SAAOsF,OAAP,CAAe,sCAAsCH,IAAtC,GAA6C,QAA5D,EAAsE,UAAC3C,QAAD,EAAc;AACnF,OAAKA,QAAL,EAAe;AACd1C,YAAQyF,UAAR,CAAmBtB,EAAnB,EAAuB,UAACzB,QAAD,EAAc;AACpC,SAAIA,SAASA,QAAT,IAAqB,IAArB,IAA6BA,SAASC,WAAT,IAAwB,GAAzD,EAA8D;AAC7DvB,WAAKU,WAAL;AACA;AACD,KAJD;AAKA;AACD,GARD;AASA,EAXD;;AAaA,KAAIV,OAAO,SAAPA,IAAO,CAACS,IAAD,EAAU;AACpB9B,SAAOY,QAAP,GAAkB,IAAlB;AACAZ,SAAOS,MAAP,GAAgB,IAAhB;AACAH,YAAU,CAAV;AACAL,UAAQyC,UAAR,CAAmBlB,EAAEC,MAAF,CAAS,EAAEpB,YAAF,EAASyB,UAAT,EAAeW,QAAQ,CAAvB,EAA0BT,SAAShC,OAAOgC,OAAP,CAAeC,KAAf,GAAuB,GAAvB,GAA6BjC,OAAOgC,OAAP,CAAeE,KAA/E,EAAsFR,WAAWX,OAAOf,OAAOc,SAAd,EAAyBa,MAAzB,CAAgCvB,UAAUwB,UAA1C,CAAjG,EAAwJC,SAASd,OAAOf,OAAOmB,OAAd,EAAuBQ,MAAvB,CAA8BvB,UAAUwB,UAAxC,CAAjK,EAAT,EAAiOJ,EAAEW,KAAnO,CAAnB,EAA8P,UAACQ,QAAD,EAAc;AAC3Q,OAAIA,SAASA,QAAT,IAAqB,IAArB,IAA6BA,SAASC,WAAT,IAAwB,GAAzD,EAA8D;AAC7D5C,WAAOW,IAAP,GAAcgC,SAASE,MAAvB;AACA,QAAI,CAACF,SAASE,MAAd,EAAsB;AACrB7C,YAAOS,MAAP,GAAgBL,UAAUK,MAA1B,CAAkCT,OAAOa,OAAP,GAAiB,IAAjB;AAClC,KAFD,MAEQ,IAAI8B,SAASE,MAAT,CAAgBT,MAAhB,GAAyB/B,KAA7B,EAAoC;AAC3CL,YAAOa,OAAP,GAAiB,IAAjB;AACA,KAFO,MAED;AACNb,YAAOa,OAAP,GAAiB,KAAjB;AACA;AACDb,WAAOY,QAAP,GAAkB,KAAlB;AACA;AACD,GAZD;AAaA,EAjBD;;AAmBAS;AACA,CA1KgC,CAAjC","file":"userController.js","sourcesContent":["app.controller('UserController', ['$scope', 'fetcher', '$timeout', 'dialog', 'globalVar', function ($scope, fetcher, $timeout, dialog, globalVar) {\n    'use strict';\n\n\tlet limit\t\t= 10;\n\tlet iterate\t\t= 0;\n\tlet typeDelay\t= 500;\n\n\t$scope.search\t= \"\";\n\t$scope.nodata\t= null;\n\t$scope.loading\t= globalVar.loading;\n\n\t$scope.data\t\t= [];\n\t$scope.pauseAjx\t= false;\n\t$scope.doneAjx\t= false;\n\n\t$scope.startDate\t= moment().year(2017).startOf('year').toDate();\n\t$scope.endDate\t\t= moment().toDate();\n\t$scope.dateChange\t= () => { init(); }\n\t$scope.downloadLink\t= () => (fetcher.getFilesLink('userdata', _.omitBy({\n\t\tstartdate: moment($scope.startDate).format(globalVar.dateFormat),\n\t\tenddate: moment($scope.endDate).format(globalVar.dateFormat),\n\t\tlike: getSearch(),\n\t\torderby: $scope.orderby.value + ' ' + $scope.orderby.order,\n\t}, _.isNil)));\n\n\tlet getSearch\t= () => ($scope.search ? (($scope.search.length >= 3) ? $scope.search : null) : null);\n\n\t$scope.openHint\t= () => { dialog.notif(globalVar.userHint); }\n\n\t$scope.loadMoar\t= () => {\n\t\t$scope.pauseAjx\t= true;\n\t\titerate++;\n\t\tlet data = _.omitBy({\n\t\t\tlimit,\n\t\t\toffset: iterate * limit,\n\t\t\tlike: getSearch(),\n\t\t\torderby: $scope.orderby.value + ' ' + $scope.orderby.order,\n\t\t\tstartdate: moment($scope.startDate).format(globalVar.dateFormat),\n\t\t\tenddate: moment($scope.endDate).format(globalVar.dateFormat),\n\t\t}, _.isNil);\n\t\tfetcher.getAllUser(data, (response) => {\n\t\t\tif (response.response == 'OK' && response.status_code == 200 && response.result) {\n\t\t\t\tif (response.result.length < limit) { $scope.doneAjx = true; }\n\t\t\t\t$scope.data \t= _.concat($scope.data, response.result);\n\t\t\t} else {\n\t\t\t\t$scope.doneAjx\t= true;\n\t\t\t}\n\t\t\t$scope.pauseAjx\t= false;\n\t\t});\n\t}\n\n\t$scope.toYear\t= (birthyear) => ( birthyear < moment().format('YYYY') ? moment().diff(moment().year(birthyear), 'years') : null);\n\n\tlet delayTimeout;\n\t$scope.$watch('search', (newVal, oldVal) => {\n\t\tif (!_.isNil(newVal) && newVal !== oldVal) {\n\t\t\tif (delayTimeout) $timeout.cancel(delayTimeout);\n\n\t\t\tdelayTimeout\t= $timeout(() => {\n\t\t\t\tif (newVal.length >= 3) {\n\t\t\t\t\tinit(newVal);\n\t\t\t\t} else if (newVal == '' && !$scope.pauseAjx) {\n\t\t\t\t\tinit();\n\t\t\t\t}\n\t\t\t}, typeDelay);\n\t\t} else {\n\t\t\t$scope.search = '';\n\t\t}\n\t});\n\n\t$scope.orderOptions\t= [\n\t\t{ title: 'nama', value: 'usr_display_name', order: 'ASC' },\n\t\t{ title: 'jabatan', value: 'usr_designation', order: 'ASC' },\n\t\t{ title: 'desa', value: 'usr_village', order: 'ASC' },\n\t\t{ title: 'umur', value: 'usr_year_born', order: 'ASC' },\n\t\t{ title: 'skor', value: 'usr_score', order: 'ASC' },\n\t\t{ title: 'kontribusi', value: 'usr_contribution', order: 'ASC' },\n\t];\n\n\t$scope.orderby\t\t= _.head($scope.orderOptions);\n\t$scope.selectSort\t= (selected) => {\n\t\tif ($scope.orderby.title == selected.title) {\n\t\t\tselected.order\t= selected.order == 'ASC' ? 'DESC' : 'ASC';\n\t\t} else {\n\t\t\tselected.order\t= 'ASC';\n\t\t}\n\n\t\t$scope.orderby = selected;\n\n\t\tinit(getSearch());\n\t}\n\n\t$scope.newUser\t= () => {\n\t\tdialog.userDialog({}, (dialResp) => {\n\t\t\tif (_.isObject(dialResp)) {\n\t\t\t\tfetcher.postUser(_.mapValues(dialResp, _.toString), (response) => {\n\t\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\t\tinit(getSearch());\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\t$scope.editUser\t= (id) => {\n\t\tasync.waterfall([\n\t\t\t(callback) => {\n\t\t\t\tfetcher.getUser(id, (response) => {\n\t\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\t\tcallback(null, response.result);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcallback(response.message);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\t(userData, callback) => {\n\t\t\t\tlet before\t= _.clone(userData);\n\t\t\t\tdialog.userDialog(userData, (response) => {\n\t\t\t\t\tif (_.isObject(response) && !_.isEqual(before, response)) {\n\t\t\t\t\t\tcallback(null, response);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcallback(null);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t], (err, result) => {\n\t\t\tif (err) { console.log(err); }\n\n\t\t\tif (result) {\n\t\t\t\tfetcher.putUser(result.ID, _.chain(result).mapValues(_.toString).omit(['last_logged_in', 'usr_score']).value(), (response) => {\n\t\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\t\tinit(getSearch());\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\n\t$scope.delete\t= (id, name, e) => {\n\t\te.stopPropagation();\n\t\tdialog.confirm('Apakah anda yakin akan menghapus ' + name + ' akun?', (response) => {\n\t\t\tif  (response) {\n\t\t\t\tfetcher.deleteUser(id, (response) => {\n\t\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\t\tinit(getSearch());\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tlet init\t= (like) => {\n\t\t$scope.pauseAjx\t= true;\n\t\t$scope.nodata\t= null;\n\t\titerate\t= 0;\n\t\tfetcher.getAllUser(_.omitBy({ limit, like, offset: 0, orderby: $scope.orderby.value + ' ' + $scope.orderby.order, startdate: moment($scope.startDate).format(globalVar.dateFormat), enddate: moment($scope.endDate).format(globalVar.dateFormat) }, _.isNil), (response) => {\n\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t$scope.data\t= response.result;\n\t\t\t\tif (!response.result) {\n\t\t\t\t\t$scope.nodata = globalVar.nodata; $scope.doneAjx = true;\n\t\t\t\t} else  if (response.result.length < limit) {\n\t\t\t\t\t$scope.doneAjx = true;\n\t\t\t\t} else {\n\t\t\t\t\t$scope.doneAjx\t= false;\n\t\t\t\t}\n\t\t\t\t$scope.pauseAjx\t= false;\n\t\t\t}\n\t\t});\n\t}\n\n\tinit();\n}]);\n"]}