{"version":3,"sources":["../../../js/dashboard/userController.js"],"names":["app","controller","$scope","fetcher","$timeout","dialog","globalVar","limit","iterate","typeDelay","search","nodata","forHide","data","pauseAjx","doneAjx","loadMoar","_","omitBy","offset","like","length","orderby","value","order","isNil","getAllUser","response","status_code","result","concat","delayTimeout","$watch","newVal","oldVal","cancel","init","orderOptions","title","head","selectSort","selected","newUser","userDialog","dialResp","isObject","postUser","editUser","id","async","waterfall","callback","getUser","message","userData","before","clone","isEqual","err","console","log","putUser","ID","chain","mapValues","toString","omit","emailTo","name","e","stopPropagation","delete","confirm","deleteUser"],"mappings":"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","file":"userController.js","sourcesContent":["app.controller('UserController', ['$scope', 'fetcher', '$timeout', 'dialog', 'globalVar', function ($scope, fetcher, $timeout, dialog, globalVar) {\n    'use strict';\n\n\tlet limit\t\t= 10;\n\tlet iterate\t\t= 0;\n\tlet typeDelay\t= 500;\n\n\t$scope.search\t= \"\";\n\t$scope.nodata\t= null;\n\n\t$scope.forHide\t= false;\n\n\t$scope.data\t\t= [];\n\t$scope.pauseAjx\t= false;\n\t$scope.doneAjx\t= false;\n\n\t$scope.loadMoar\t= () => {\n\t\t$scope.pauseAjx\t= true;\n\t\titerate++;\n\t\tlet data = _.omitBy({\n\t\t\tlimit,\n\t\t\toffset: iterate * limit,\n\t\t\tlike: $scope.search ? (($scope.search.length >= 3) ? $scope.search : null) : null,\n\t\t\torderby: $scope.orderby.value + ' ' + $scope.orderby.order,\n\t\t}, _.isNil);\n\t\tfetcher.getAllUser(data, (response) => {\n\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\tif (response.result.length < limit) { $scope.doneAjx = true; }\n\t\t\t\t$scope.data \t= _.concat($scope.data, response.result);\n\t\t\t} else {\n\t\t\t\t$scope.doneAjx\t= true;\n\t\t\t}\n\t\t\t$scope.pauseAjx\t= false;\n\t\t});\n\t}\n\n\tlet delayTimeout;\n\t$scope.$watch('search', (newVal, oldVal) => {\n\t\tif (!_.isNil(newVal)) {\n\t\t\tif (delayTimeout) $timeout.cancel(delayTimeout);\n\n\t\t\tdelayTimeout\t= $timeout(() => {\n\t\t\t\tif (newVal !== oldVal && newVal.length >= 3) {\n\t\t\t\t\tinit(newVal);\n\t\t\t\t} else if (newVal == '') {\n\t\t\t\t\tinit();\n\t\t\t\t}\n\t\t\t}, typeDelay);\n\t\t} else {\n\t\t\t$scope.search = '';\n\t\t}\n\t});\n\n\t$scope.orderOptions\t= [\n\t\t{ title: 'name', value: 'usr_display_name', order: 'ASC' },\n\t\t{ title: 'designation', value: 'usr_designation', order: 'ASC' },\n\t\t{ title: 'village', value: 'usr_village', order: 'ASC' },\n\t\t{ title: 'age', value: 'usr_years', order: 'ASC' },\n\t\t{ title: 'score', value: 'usr_score', order: 'ASC' },\n\t\t{ title: 'contribution', value: 'usr_contribution', order: 'ASC' },\n\t];\n\n\t$scope.orderby\t\t= _.head($scope.orderOptions);\n\t$scope.selectSort\t= (selected) => {\n\t\tif ($scope.orderby.title == selected.title) {\n\t\t\tselected.order\t= selected.order == 'ASC' ? 'DESC' : 'ASC';\n\t\t} else {\n\t\t\tselected.order\t= 'ASC';\n\t\t}\n\n\t\t$scope.orderby = selected;\n\n\t\tinit($scope.search ? (($scope.search.length >= 3) ? $scope.search : null) : null);\n\t}\n\n\t$scope.newUser\t= () => {\n\t\tdialog.userDialog({}, (dialResp) => {\n\t\t\tif (_.isObject(dialResp)) {\n\t\t\t\tfetcher.postUser(dialResp, (response) => {\n\t\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\t\tinit($scope.search ? (($scope.search.length >= 3) ? $scope.search : null) : null);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\t$scope.editUser\t= (id) => {\n\t\tasync.waterfall([\n\t\t\t(callback) => {\n\t\t\t\tfetcher.getUser(id, (response) => {\n\t\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\t\tcallback(null, response.result);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcallback(response.message);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\t(userData, callback) => {\n\t\t\t\tlet before\t= _.clone(userData);\n\t\t\t\tdialog.userDialog(userData, (response) => {\n\t\t\t\t\tif (_.isObject(response) && !_.isEqual(before, response)) {\n\t\t\t\t\t\tcallback(null, response);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcallback(null);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t], (err, result) => {\n\t\t\tif (err) { console.log(err); }\n\n\t\t\tfetcher.putUser(result.ID, _.chain(result).mapValues(_.toString).omit(['last_logged_in', 'usr_score']).value(), (response) => {\n\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\tinit($scope.search ? (($scope.search.length >= 3) ? $scope.search : null) : null);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t};\n\n\t$scope.emailTo\t= (id, name, e) => {\n\t\te.stopPropagation();\n\t}\n\t$scope.delete\t= (id, name, e) => {\n\t\te.stopPropagation();\n\t\tdialog.confirm('Are you sure you wanna delete ' + name + '\\'s account?', (response) => {\n\t\t\tfetcher.deleteUser(id, (response) => {\n\t\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t\tinit($scope.search ? (($scope.search.length >= 3) ? $scope.search : null) : null);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tlet init\t= (like) => {\n\t\t$scope.pauseAjx\t= true;\n\t\t$scope.nodata\t= null;\n\t\titerate\t= 0;\n\t\tfetcher.getAllUser(_.omitBy({ limit, like, offset: 0, orderby: $scope.orderby.value + ' ' + $scope.orderby.order }, _.isNil), (response) => {\n\t\t\tif (response.response == 'OK' && response.status_code == 200) {\n\t\t\t\t$scope.data\t= response.result;\n\t\t\t\tif (!response.result) {\n\t\t\t\t\t$scope.nodata = globalVar.nodata;\n\t\t\t\t} else  if (response.result.length < limit) {\n\t\t\t\t\t$scope.doneAjx = true;\n\t\t\t\t} else {\n\t\t\t\t\t$scope.doneAjx\t= false;\n\t\t\t\t}\n\t\t\t\t$scope.pauseAjx\t= false;\n\t\t\t}\n\t\t});\n\t}\n\n\tinit();\n}]);\n"]}