"use strict";var angular=angular,app=angular.module("app",["ui.router","ct.ui.router.extras.core","permission","permission.ui","LocalStorageModule","ngDialog","angular-loading-bar","ngAnimate","infinite-scroll","ngMaterial"]);app.config(["$stateProvider","$locationProvider","$urlRouterProvider","$httpProvider","$mdThemingProvider","localStorageServiceProvider","cfpLoadingBarProvider",function(a,b,c,d,e,f,g){c.otherwise(function(a){a.get("$state").go("dashboard")}),a.state("dashboard",{url:"",templateUrl:"views/dashboard/dashboard.html",controller:"DashboardController",abstract:!0}).state("dashboard.statistic",{url:"",templateUrl:"views/dashboard/statistic.html",controller:"StatisticController"}).state("dashboard.user",{url:"/user",templateUrl:"views/dashboard/user.html",controller:"UserController"}).state("dashboard.choices",{url:"/choices",templateUrl:"views/dashboard/choices/question.html",controller:"ChoicesController"}).state("dashboard.choicesAns",{url:"/choicesAns",templateUrl:"views/dashboard/choices/answer.html",controller:"ChoicesAnsController"}).state("dashboard.essay",{url:"/essay",templateUrl:"views/dashboard/essay/question.html",controller:"EssayController"}).state("dashboard.essayAns",{url:"/essayAns",templateUrl:"views/dashboard/essay/answer.html",controller:"EssayAnsController"}).state("dashboard.location",{url:"/location",templateUrl:"views/dashboard/location.html",controller:"LocationController"}).state("dashboard.misc",{url:"/misc",templateUrl:"views/dashboard/misc.html",controller:"MiscController"}),f.setPrefix("gapuradesa"),g.parentSelector="#loading-bar-container",e.disableTheming()}]),app.controller("MainController",["$scope","$rootScope","$location","localStorageService","fetcher",function(a,b,c,d,e){}]),app.run(["PermPermissionStore","localStorageService","$templateCache",function(a,b,c){}]),app.controller("CategoryController",["$scope","fetcher",function(a,b){}]),app.controller("ChoicesAnsController",["$scope","fetcher",function(a,b){}]),app.controller("ChoicesController",["$scope","fetcher",function(a,b){}]),app.controller("DashboardController",["$scope","$location","$document","$state","localStorageService","fetcher",function(a,b,c,d,e,f){a.menus=[{title:"Statistic",icon:"line-chart",state:"statistic"},{title:"User",icon:"user",state:"user"},{title:"Choices' Question",icon:"th-large",state:"choices"},{title:"Choices' Answer",icon:"square",state:"choicesAns"},{title:"Essay's Question",icon:"pencil-square-o",state:"essay"},{title:"Essay's Answer",icon:"file-text-o",state:"essayAns"},{title:"Location",icon:"map-o",state:"location"},{title:"Miscellaneous",icon:"cogs",state:"misc"}];var g=b.url().split("/")[1];a.active=g||_.chain(a.menus).head().get("state").value(),a.setActive=function(b){a.active=b,d.go("dashboard."+b)}}]),app.controller("EssayAnsController",["$scope","fetcher",function(a,b){}]),app.controller("EssayController",["$scope","fetcher",function(a,b){}]),app.controller("LocationController",["$scope","fetcher",function(a,b){}]),app.controller("MiscController",["$scope","fetcher",function(a,b){}]),app.controller("StatisticController",["$scope","fetcher",function(a,b){}]),app.controller("UserController",["$scope","fetcher","$timeout","dialog","globalVar",function(a,b,c,d,e){var f=0;a.search="",a.nodata=null,a.forHide=!1,a.data=[],a.pauseAjx=!1,a.doneAjx=!1,a.loadMoar=function(){a.pauseAjx=!0,f++;var c=_.omitBy({limit:10,offset:10*f,like:a.search&&a.search.length>=3?a.search:null,orderby:a.orderby.value+" "+a.orderby.order},_.isNil);b.getAllUser(c,function(b){"OK"==b.response&&200==b.status_code?(b.result.length<10&&(a.doneAjx=!0),a.data=_.concat(a.data,b.result)):a.doneAjx=!0,a.pauseAjx=!1})};var g=void 0;a.$watch("search",function(b,d){_.isNil(b)?a.search="":(g&&c.cancel(g),g=c(function(){b!==d&&b.length>=3?h(b):""==b&&h()},500))}),a.orderOptions=[{title:"name",value:"usr_display_name",order:"ASC"},{title:"designation",value:"usr_designation",order:"ASC"},{title:"village",value:"usr_village",order:"ASC"},{title:"age",value:"usr_years",order:"ASC"},{title:"score",value:"usr_score",order:"ASC"},{title:"contribution",value:"usr_contribution",order:"ASC"}],a.orderby=_.head(a.orderOptions),a.selectSort=function(b){a.orderby.title==b.title?b.order="ASC"==b.order?"DESC":"ASC":b.order="ASC",a.orderby=b,h(a.search&&a.search.length>=3?a.search:null)},a.newUser=function(){d.userDialog({},function(c){_.isObject(c)&&b.postUser(c,function(b){"OK"==b.response&&200==b.status_code&&h(a.search&&a.search.length>=3?a.search:null)})})},a.editUser=function(c){async.waterfall([function(a){b.getUser(c,function(b){"OK"==b.response&&200==b.status_code?a(null,b.result):a(b.message)})},function(a,b){var c=_.clone(a);d.userDialog(a,function(a){_.isObject(a)&&!_.isEqual(c,a)?b(null,a):b(null)})}],function(c,d){c&&console.log(c),b.putUser(d.ID,_.chain(d).mapValues(_.toString).omit(["last_logged_in","usr_score"]).value(),function(b){"OK"==b.response&&200==b.status_code&&h(a.search&&a.search.length>=3?a.search:null)})})},a.emailTo=function(a,b,c){c.stopPropagation()},a.delete=function(c,e,f){f.stopPropagation(),d.confirm("Are you sure you wanna delete "+e+"'s account?",function(d){b.deleteUser(c,function(b){"OK"==b.response&&200==b.status_code&&h(a.search&&a.search.length>=3?a.search:null)})})};var h=function(c){a.pauseAjx=!0,a.nodata=null,f=0,b.getAllUser(_.omitBy({limit:10,like:c,offset:0,orderby:a.orderby.value+" "+a.orderby.order},_.isNil),function(b){"OK"==b.response&&200==b.status_code&&(a.data=b.result,b.result?b.result.length<10?a.doneAjx=!0:a.doneAjx=!1:a.nodata=e.nodata,a.pauseAjx=!1)})};h()}]),app.controller("ModalUserController",["$scope","fetcher",function(a,b){a.data=a.ngDialogData.content||{},a.autoData={province:[],regency:[],district:[],village:[]},a.autoSearch={province:"",regency:"",district:"",village:""},a.autoModel={province:null,regency:null,district:null,village:null};var c=function(a){return _.chain(a).map(function(a){return _.chain(a).pickBy(function(a,b){return _.includes(["id","education"],b)||_.startsWith(b,"name")}).mapKeys(function(a,b){return"id"==b?"id":"name"}).value()}).value()},d=function(b,c,d){var e=_.find(b,["id",c]);a.autoData[d]=e,a.autoSearch[d]=e.name},e=function(a){return function(b){return _.includes(angular.lowercase(b.name),angular.lowercase(a))}};a.querySearch=function(b){return a.autoSearch[b]?a.autoData[b].filter(e(a.autoSearch[b])):a.autoData[b]},a.isDisAuto=function(b){switch(b){case"regency":return _.isEmpty(a.data.usr_province);case"district":return _.isEmpty(a.data.usr_province)||_.isEmpty(a.data.usr_regency);case"village":return _.isEmpty(a.data.usr_province)||_.isEmpty(a.data.usr_regency)||_.isEmpty(a.data.usr_district);default:return!1}},a.autoChanged=function(d,e,f){if(d){var g="",h=["province","regency","district","village"],i=_.indexOf(h,e)+1;switch(a.data[f]=d,e){case"province":g=d;break;case"regency":g=a.data.usr_province+"/"+d;break;case"district":g=a.data.usr_province+"/"+a.data.usr_regency+"/"+d;break;default:return}_.chain(h).drop(i).forEach(function(b){a.autoModel[b]=null,a.autoSearch[b]="",a.data["usr_"+b]=null}).value(),b.getLocation(g,{},function(b){"OK"==b.response&&200==b.status_code&&(a.autoData[h[i]]=c(b.result))})}};!function(){async.parallel({instits:function(a){b.getAllInstitution({},function(b){"OK"==b.response&&200==b.status_code?a(null,c(b.result)):a(b.message)})},educats:function(a){b.getAllEducation({},function(b){"OK"==b.response&&200==b.status_code?a(null,c(b.result)):a(b.message)})},province:function(e){b.getLocation("",{},function(b){if("OK"==b.response&&200==b.status_code){var f=c(b.result);a.data.usr_province&&d(f,a.data.usr_province,"province"),e(null,f)}else e(b.message)})},regency:function(e){a.data.ID&&a.data.usr_province?b.getLocation(a.data.usr_province,{},function(b){if("OK"==b.response&&200==b.status_code){var f=c(b.result);a.data.usr_regency&&d(f,a.data.usr_regency,"regency"),e(null,f)}else e(b.message)}):e(null,[])},district:function(e){a.data.ID&&a.data.usr_province&&a.data.usr_regency?b.getLocation(a.data.usr_province+"/"+a.data.usr_regency,{},function(b){if("OK"==b.response&&200==b.status_code){var f=c(b.result);a.data.usr_district&&d(f,a.data.usr_district,"district"),e(null,f)}else e(b.message)}):e(null,[])},village:function(e){a.data.ID&&a.data.usr_province&&a.data.usr_regency&&a.data.usr_district?b.getLocation(a.data.usr_province+"/"+a.data.usr_regency+"/"+a.data.usr_district,{},function(b){if("OK"==b.response&&200==b.status_code){var f=c(b.result);a.data.usr_village&&d(f,a.data.usr_village,"village"),e(null,f)}else e(b.message)}):e(null,[])}},function(b,c){b&&console.log(b),a.autoData.province=c.province,a.autoData.regency=c.regency,a.autoData.district=c.district,a.autoData.village=c.village,a.inputs=[{label:"name",model:"usr_display_name",tag:"input",type:"text",required:!0},{label:"email",model:"usr_email",tag:"input",type:"email",required:!0},{label:"password",model:"usr_password",tag:"input",type:"password",required:!0},{label:"year of born",model:"usr_year_born",tag:"input",type:"number"},{label:"designation",model:"usr_designation",tag:"input",type:"text"},{label:"gender",model:"usr_gender",tag:"radio",value:[{label:"male",value:"m"},{label:"female",value:"f"}]},{label:"institution",model:"usr_institution",tag:"select",value:c.instits},{label:"education",model:"usr_education",tag:"select",value:c.educats},{label:"province",model:"usr_province",tag:"autocomplete",value:"province"},{label:"regency",model:"usr_regency",tag:"autocomplete",value:"regency"},{label:"district",model:"usr_district",tag:"autocomplete",value:"district"},{label:"village",model:"usr_village",tag:"autocomplete",value:"village"}]})}()}]),app.directive("autofocus",["$timeout",function(a){return{link:function(b,c,d){a(function(){c.focus()})}}}]),app.directive("typeEverywhere",["$document",function(a){return{require:"ngModel",restrict:"A",scope:{ngModel:"="},link:function(b,c,d){a.bind("keypress",function(d){var e=d.which||d.keyCode,f=angular.element(a[0].activeElement)[0].tagName;_.includes([13],e)||_.includes(["INPUT","TEXTAREA"],f)||(b.ngModel+=String.fromCharCode(e),c.focus())})}}}]),app.directive("openDropdown",["$document",function(a){return{restrict:"A",scope:{openDropdown:"="},link:function(b,c,d){function e(a){b.$apply(function(){b.openDropdown=!b.openDropdown})}b.openDropdown=!1;for(var f=[c[0]],g=c.children().length,h=c.children();g;)f=_.concat(f,_.chain(h).pick(_.times(h.length)).values().value()),h=h.children(),g=h.length;c.bind("click",e),a.bind("click",function(a){_.includes(f,a.target)||b.$apply(function(){b.openDropdown=!1})})}}}]),app.factory("fetcher",["$http","$httpParamSerializer","$window","$location",function(a,b,c,d){var e="http://localhost:3010/",f={headers:{"Content-Type":"application/json; charset=utf-8"}};return{getAllUser:function(c,d){a.get(e+"user?"+b(c),f).then(function(a){d(a.data)},function(a){d(a.data)})},getUser:function(b,c){a.get(e+"user/"+b,f).then(function(a){c(a.data)},function(a){c(a.data)})},postUser:function(b,c){a.post(e+"user",b,f).then(function(a){c(a.data)},function(a){c(a.data)})},putUser:function(b,c,d){a.put(e+"user/"+b,c,f).then(function(a){d(a.data)},function(a){d(a.data)})},deleteUser:function(b,c){a.delete(e+"user/"+b,f).then(function(a){c(a.data)},function(a){c(a.data)})},getAllEducation:function(c,d){a.get(e+"education?"+b(c),f).then(function(a){d(a.data)},function(a){d(a.data)})},getAllInstitution:function(c,d){a.get(e+"institution?"+b(c),f).then(function(a){d(a.data)},function(a){d(a.data)})},getLocation:function(c,d,g){a.get(e+"location/"+c+"?"+b(d),f).then(function(a){g(a.data)},function(a){g(a.data)})}}}]),app.factory("dialog",["ngDialog",function(a){var b=function(b,c,d,e,f,g){return a.open({template:"views/dialogs/"+c+".html",className:"ngdialog-theme-default"+(g?" "+g:""),data:{content:b},width:e||450,showClose:f||!1,controller:d})};return{userDialog:function(a,c){b(a,"user","ModalUserController",1e3).closePromise.then(function(a){c(a.value)})},confirm:function(a,c){b(a,"confirm",["$scope",function(a){}]).closePromise.then(function(a){c("yes"==a.value)})},notif:function(a){b(a,"notif",["$scope",function(a){}])},error:function(a){b(a,"error",["$scope",function(a){}])}}}]),app.factory("globalVar",[function(){return{nodata:"no data available at this point."}}]);
//# sourceMappingURL=main.min.js.map